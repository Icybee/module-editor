!function(){function e(e){var t,i=Math.max(r+e.client.y-l,100);t="IFRAME"==a.tagName?a.getNext():a.getPrevious(),a.setStyle("height",i),t.setStyle("height",i)}function t(){window.removeEvent("mousemove",e),window.removeEvent("mouseup",t),"IFRAME"==a.tagName&&a.setStyle("visibility",""),a=null}var i=/^(H[1-6]|HR|P|DIV|ADDRESS|PRE|FORM|TABLE|LI|OL|UL|TD|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD|SCRIPT|NOSCRIPT|STYLE|ARTICLE|ASIDE|DETAILS|FIGCAPTION|FIGURE|FOOTER|HEADER|HGROUP|NAV)$/i,o=/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i,s=/<(script|noscript|style)[\u0000-\uFFFF]*?<\/(script|noscript|style)>/g;this.MooEditable=new Class({Implements:[Events,Options],options:{toolbar:!0,cleanup:!0,paragraphise:!0,xhtml:!0,semantics:!0,actions:"bold italic underline strikethrough | insertunorderedlist insertorderedlist indent outdent | undo redo | createlink unlink | urlimage | toggleview",handleSubmit:!0,handleLabel:!0,disabled:!1,baseCSS:"html{ height: 100%; cursor: text; } body{ font-family: sans-serif; }",extraCSS:"",externalCSS:"",html:'<!DOCTYPE html><html id="{HTMLID}" lang="{LANGUAGE}"><head><meta charset="UTF-8">{BASEHREF}<style>{BASECSS} {EXTRACSS}</style>{EXTERNALCSS}</head><body class="editor-rte"></body></html>',rootElement:"p",baseURL:"",dimensions:null,htmlId:"wysiwyg"},initialize:function(e,t){("contentEditable"in document.body||"designMode"in document)&&(this.setOptions(t),this.textarea=document.id(e),this.textarea.store("MooEditable",this),this.textarea.addEvent("change",function(){this.setContent(this.textarea.get("value"))}.bind(this)),this.actions=this.options.actions.clean().split(" "),this.keys={},this.dialogs={},this.protectedElements=[],this.actions.each(function(e){var t=MooEditable.Actions[e];if(t){if(t.options){var i=t.options.shortcut;i&&(this.keys[i]=e)}t.dialogs&&Object.each(t.dialogs,function(t,i){t=t.attempt(this),t.name=e+":"+i,"object"!=typeOf(this.dialogs[e])&&(this.dialogs[e]={}),this.dialogs[e][i]=t},this),t.events&&Object.each(t.events,function(e,t){this.addEvent(t,e)},this)}}.bind(this)),this.render())},toElement:function(){return this.textarea},render:function(){var e=this,t=this.options.dimensions||this.textarea.getSize();this.container=new Element("div",{id:this.textarea.id?this.textarea.id+"-mooeditable-container":null,"class":"mooeditable-container"}),this.textarea.addClass("mooeditable-textarea").setStyle("height",t.y),this.iframe=new IFrame({"class":"mooeditable-iframe",frameBorder:0,src:'javascript:""',styles:{height:Math.max(100,t.y)}}),this.resizer=new Element("div.mooeditable-resizer"),this.toolbar=new MooEditable.UI.Toolbar({onItemAction:function(){var t=Array.from(arguments),i=t[0];e.action(i.name,t)}}),this.attach.delay(1,this),this.options.handleLabel&&this.textarea.id&&$$('label[for="'+this.textarea.id+'"]').addEvent("click",function(t){"iframe"==e.mode&&(t.preventDefault(),e.focus())}),this.options.handleSubmit&&(this.form=this.textarea.getParent("form"),this.form&&this.form.addEvent("submit",function(){"iframe"==e.mode&&e.saveContent()})),this.fireEvent("render",this)},attach:function(){var e=this;this.mode="iframe",this.editorDisabled=!1,this.container.wraps(this.textarea),this.textarea.setStyle("display","none"),this.iframe.setStyle("display","").inject(this.textarea,"before"),this.resizer.inject(this.textarea,"after"),Object.each(this.dialogs,function(t,i){Object.each(t,function(t){document.id(t).inject(e.iframe,"before");var o;t.addEvents({open:function(){o=e.selection.getRange(),e.editorDisabled=!0,e.toolbar.disable(i),e.fireEvent("dialogOpen",this)},close:function(){e.toolbar.enable(),e.editorDisabled=!1,e.focus(),o&&e.selection.setRange(o),e.fireEvent("dialogClose",this)}})})}),this.win=this.iframe.contentWindow,this.doc=this.win.document,Browser.firefox&&(this.doc.designMode="On");var t="";this.options.externalCSS&&("array"==typeOf(this.options.externalCSS)?this.options.externalCSS.each(function(e){t+='<link rel="stylesheet" href="'+e+'">\n'}):t='<link rel="stylesheet" href="'+this.options.externalCSS+'">'),this.baseHREF=document.location.protocol+"//"+document.location.hostname;var i=this.options.html.substitute({BASECSS:this.options.baseCSS,EXTRACSS:this.options.extraCSS,EXTERNALCSS:t,BASEHREF:'<base href="'+this.baseHREF+'" />',HTMLID:this.options.htmlId,LANGUAGE:this.textarea.get("lang")||document.html.get("lang")});if(this.doc.open(),this.doc.write(i),this.doc.close(),Browser.ie?this.doc.body.contentEditable=!0:this.doc.designMode="On",Object.append(this.win,new Window),Object.append(this.doc,new Document),Browser.Element){var o=this.win.Element.prototype;for(var s in Element)s.test(/^[A-Z]|\$|prototype|mooEditable/)||(o[s]=Element.prototype[s])}else document.id(this.doc.body);if(this.setContent(this.textarea.get("value")),this.doc.addEvents({mouseup:this.editorMouseUp.bind(this),mousedown:this.editorMouseDown.bind(this),mouseover:this.editorMouseOver.bind(this),mouseout:this.editorMouseOut.bind(this),mouseenter:this.editorMouseEnter.bind(this),mouseleave:this.editorMouseLeave.bind(this),contextmenu:this.editorContextMenu.bind(this),click:this.editorClick.bind(this),dblclick:this.editorDoubleClick.bind(this),keypress:this.editorKeyPress.bind(this),keyup:this.editorKeyUp.bind(this),keydown:this.editorKeyDown.bind(this),focus:this.editorFocus.bind(this),blur:this.editorBlur.bind(this)}),this.win.addEvents({focus:this.editorFocus.bind(this),blur:this.editorBlur.bind(this),load:function(){this.actions.each(function(e){var t=MooEditable.Actions[e];t&&t.load&&t.load(this)},this)}.bind(this)}),["cut","copy","paste"].each(function(t){e.doc.body.addListener(t,e["editor"+t.capitalize()].bind(e))}),this.textarea.addEvent("keypress",this.textarea.retrieve("mooeditable:textareaKeyListener",this.keyListener.bind(this))),Browser.firefox2&&this.doc.addEvent("focus",function(){e.win.fireEvent("focus").focus()}),this.doc.addEventListener&&this.doc.addEventListener("focus",function(){e.win.fireEvent("focus")},!0),!Browser.ie&&!Browser.opera){var n=function(){e.execute("styleWithCSS",!1,!1),e.doc.removeEvent("focus",n)};this.win.addEvent("focus",n)}return this.options.toolbar&&(document.id(this.toolbar).inject(this.container,"top"),this.toolbar.render(this.actions)),this.options.disabled&&this.disable(),this.selection=new MooEditable.Selection(this.win),this.oldContent=this.getContent(),this.fireEvent("attach",this),this},detach:function(){return this.saveContent(),this.textarea.setStyle("display","").removeClass("mooeditable-textarea").inject(this.container,"before"),this.textarea.removeEvent("keypress",this.textarea.retrieve("mooeditable:textareaKeyListener")),this.container.dispose(),this.fireEvent("detach",this),this},enable:function(){return this.editorDisabled=!1,this.toolbar.enable(),this},disable:function(){return this.editorDisabled=!0,this.toolbar.disable(),this},editorFocus:function(e){this.oldContent="",this.fireEvent("editorFocus",[e,this])},editorBlur:function(e){this.oldContent=this.saveContent().getContent(),this.fireEvent("editorBlur",[e,this])},editorMouseUp:function(e){return this.editorDisabled?void e.stop():(this.options.toolbar&&this.checkStates(),void this.fireEvent("editorMouseUp",[e,this]))},editorMouseDown:function(e){return this.editorDisabled?void e.stop():void this.fireEvent("editorMouseDown",[e,this])},editorMouseOver:function(e){return this.editorDisabled?void e.stop():void this.fireEvent("editorMouseOver",[e,this])},editorMouseOut:function(e){return this.editorDisabled?void e.stop():void this.fireEvent("editorMouseOut",[e,this])},editorMouseEnter:function(e){return this.editorDisabled?void e.stop():void this.fireEvent("editorMouseEnter",[e,this])},editorMouseLeave:function(e){return this.editorDisabled?void e.stop():void this.fireEvent("editorMouseLeave",[e,this])},editorContextMenu:function(e){return this.editorDisabled?void e.stop():void this.fireEvent("editorContextMenu",[e,this])},editorClick:function(e){if(Browser.safari||Browser.chrome){var t=e.target;"img"==Element.get(t,"tag")&&(this.options.baseURL&&-1==t.getProperty("src").indexOf("http://")&&t.setProperty("src",this.options.baseURL+t.getProperty("src")),this.selection.selectNode(t),this.checkStates())}this.fireEvent("editorClick",[e,this])},editorDoubleClick:function(e){this.fireEvent("editorDoubleClick",[e,this])},editorKeyPress:function(e){return this.editorDisabled?void e.stop():(this.keyListener(e),void this.fireEvent("editorKeyPress",[e,this]))},editorKeyUp:function(e){if(this.editorDisabled)return void e.stop();var t=e.code;this.options.toolbar&&(/^enter|left|up|right|down|delete|backspace$/i.test(e.key)||t>=33&&36>=t||45==t||e.meta||e.control)&&(Browser.ie6?(clearTimeout(this.checkStatesDelay),this.checkStatesDelay=this.checkStates.delay(500,this)):this.checkStates()),this.fireEvent("editorKeyUp",[e,this])},editorKeyDown:function(e){if(this.editorDisabled)return void e.stop();if("enter"==e.key)if(this.options.paragraphise){if(e.shift&&(Browser.safari||Browser.chrome)){var t=this.selection,o=t.getRange(),s=this.doc.createElement("br");if(o.insertNode(s),o.setStartAfter(s),o.setEndAfter(s),t.setRange(o),t.getSelection().focusNode==s.previousSibling){var n=this.doc.createTextNode(" "),a=s.parentNode,r=s.nextSibling;r?a.insertBefore(n,r):a.appendChild(n),t.selectNode(n),t.collapse(1)}this.win.scrollTo(0,Element.getOffsets(t.getRange().startContainer).y),e.preventDefault()}else if(Browser.firefox||Browser.safari||Browser.chrome){var l=this.selection.getNode(),d=Element.getParents(l).include(l).some(function(e){return e.nodeName.test(i)});d||this.execute("insertparagraph")}}else if(Browser.ie){var o=this.selection.getRange(),l=this.selection.getNode();o&&"li"!=l.get("tag")&&(this.selection.insertContent("<br>"),this.selection.collapse(!1)),e.preventDefault()}if(Browser.opera){var c=e.control||e.meta;c&&"x"==e.key?this.fireEvent("editorCut",[e,this]):c&&"c"==e.key?this.fireEvent("editorCopy",[e,this]):(c&&"v"==e.key||e.shift&&45==e.code)&&this.fireEvent("editorPaste",[e,this])}this.fireEvent("editorKeyDown",[e,this])},editorCut:function(e){return this.editorDisabled?void e.stop():void this.fireEvent("editorCut",[e,this])},editorCopy:function(e){return this.editorDisabled?void e.stop():void this.fireEvent("editorCopy",[e,this])},editorPaste:function(e){return this.editorDisabled?void e.stop():void this.fireEvent("editorPaste",[e,this])},keyListener:function(e){var t="mac"===Browser.platform?e.meta:e.control;if(t&&this.keys[e.key]){e.preventDefault();var i=this.toolbar.getItem(this.keys[e.key]);i.action(e)}},focus:function(){return("iframe"==this.mode?this.win:this.textarea).focus(),this.fireEvent("focus",this),this},action:function(e,t){var i=MooEditable.Actions[e];i.command&&"function"==typeOf(i.command)?i.command.apply(this,t):(this.focus(),this.execute(e,!1,t),"iframe"==this.mode&&this.checkStates())},execute:function(e,t,i){return this.busy?void 0:(this.busy=!0,this.doc.execCommand(e,t,i),this.saveContent(),this.busy=!1,!1)},toggleView:function(){return this.fireEvent("beforeToggleView",this),"textarea"==this.mode?(this.mode="iframe",this.iframe.setStyle("display",""),this.setContent(this.textarea.value),this.textarea.setStyle("display","none")):(this.saveContent(),this.mode="textarea",this.textarea.setStyle("display",""),this.textarea.setStyle("visibility","visible"),this.iframe.setStyle("display","none")),this.fireEvent("toggleView",this),this.focus.delay(10,this),this},getContent:function(){var e=this.protectedElements,t=this.doc.body.get("html").replace(/<!-- mooeditable:protect:([0-9]+) -->/g,function(t,i){return e[i.toInt()]});return this.cleanup(this.ensureRootElement(t))},setContent:function(e){var t=this.protectedElements;return e=e.replace(s,function(e){return t.push(e),"<!-- mooeditable:protect:"+(t.length-1)+" -->"}),e=e.replace(/src="([^"]+)/gi,function(e,t){return t.match(/^http:\/\//)||("/"!=t[0]&&(t="/"+t),t=this.baseHREF+t),'src="'+t}.bind(this)),this.doc.body.set("html",this.ensureRootElement(e)),this},saveContent:function(){var e;return e="iframe"==this.mode?this.getContent():this.textearea.innerHTML,e=e.replace(new RegExp('="'+this.baseHREF,"gi"),'="'),this.textarea.set("value",e),this},ensureRootElement:function(e){if(this.options.rootElement){for(var t=new Element("div",{html:e.trim()}),o=-1,s=!1,n="",a=t.childNodes.length,r=0;a>r;r++){var l=t.childNodes[r],d=l.nodeName;if(d.test(i)||"#comment"===d?s=!0:"#text"===d?l.nodeValue.trim()&&(0>o&&(o=r),n+=l.nodeValue):(0>o&&(o=r),n+=new Element("div").adopt($(l).clone()).get("html")),r==a-1&&(s=!0),o>=0&&s){var c=new Element(this.options.rootElement,{html:n});t.replaceChild(c,t.childNodes[o]);for(var h=o+1;r>h;h++)t.removeChild(t.childNodes[h]),a--,r--,h--;o=-1,s=!1,n=""}}e=t.get("html").replace(/\n\n/g,"")}return e},checkStates:function(){var e=this.selection.getNode();e&&"element"==typeOf(e)&&this.actions.each(function(t){var o=this.toolbar.getItem(t);if(o){o.deactivate();var s=MooEditable.Actions[t].states;if(s){if("function"==typeOf(s))return void s.attempt([document.id(e),o],this);try{if(this.doc.queryCommandState(t))return void o.activate()}catch(n){}if(s.tags){var a=e;do{var r=a.tagName.toLowerCase();if(s.tags.contains(r)){o.activate(r);break}}while(null!=(a=Element.getParent(a)))}if(s.css){var a=e;do{var l=!1;for(var d in s.css){var c=s.css[d];a.style[d.camelCase()].contains(c)&&(o.activate(c),l=!0)}if(l||a.tagName.test(i))break}while(null!=(a=Element.getParent(a)))}}}}.bind(this))},cleanup:function(e){if(!this.options.cleanup)return e.trim();do{var t=e;this.options.baseURL&&(e=e.replace('="'+this.options.baseURL,'="/')),e=e.replace(/<br class\="webkit-block-placeholder">/gi,"<br />"),e=e.replace(/<span class="Apple-style-span">(.*)<\/span>/gi,"$1"),e=e.replace(/ class="Apple-style-span"/gi,""),e=e.replace(/<span style="">/gi,""),e=e.replace(/<p>\s*<br ?\/?>\s*<\/p>/gi,"<p> </p>"),e=e.replace(/<p>(&nbsp;|\s)*<\/p>/gi,"<p> </p>"),this.options.semantics||(e=e.replace(/\s*<br ?\/?>\s*<\/p>/gi,"</p>")),this.options.xhtml&&(e=e.replace(/<br>/gi,"<br />")),this.options.semantics&&(Browser.ie&&(e=e.replace(/<li>\s*<div>(.+?)<\/div><\/li>/g,"<li>$1</li>")),(Browser.safari||Browser.chrome)&&(e=e.replace(/^([\w\s]+.*?)<div>/i,"<p>$1</p><div>"),e=e.replace(/<div>(.+?)<\/div>/gi,"<p>$1</p>")),Browser.ie||(e=e.replace(/<p>[\s\n]*(<(?:ul|ol)>.*?<\/(?:ul|ol)>)(.*?)<\/p>/gi,"$1<p>$2</p>"),e=e.replace(/<\/(ol|ul)>\s*(?!<(?:p|ol|ul|img).*?>)((?:<[^>]*>)?\w.*)$/g,"</$1><p>$2</p>")),e=e.replace(/<br[^>]*><\/p>/g,"</p>"),e=e.replace(/<p([^>]*)>(.*?)<\/p>(?!\n)/g,"<p$1>$2</p>\n"),e=e.replace(/<\/(ul|ol|p)>(?!\n)/g,"</$1>\n"),e=e.replace(/><li>/g,">\n	<li>"),e=e.replace(/([^\n])<\/(ol|ul)>/g,"$1\n</$2>"),e=e.replace(/([^\n])<img/gi,"$1\n<img"),e=e.replace(/^\s*$/g,"")),e=e.replace(/<br ?\/?>$/gi,""),e=e.replace(/^<br ?\/?>/gi,""),this.options.paragraphise&&(e=e.replace(/(h[1-6]|p|div|address|pre|li|ol|ul|blockquote|center|dl|dt|dd)><br ?\/?>/gi,"$1>")),e=e.replace(/<br ?\/?>\s*<\/(h1|h2|h3|h4|h5|h6|li|p)/gi,"</$1"),e=e.replace(/<span style="font-weight: bold;">(.*)<\/span>/gi,"<strong>$1</strong>"),e=e.replace(/<span style="font-style: italic;">(.*)<\/span>/gi,"<em>$1</em>"),e=e.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>"),e=e.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>"),e=e.replace(/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration: underline;">$1</span>'),e=e.replace(/<strong><span style="font-weight: normal;">(.*)<\/span><\/strong>/gi,"$1"),e=e.replace(/<em><span style="font-weight: normal;">(.*)<\/span><\/em>/gi,"$1"),e=e.replace(/<span style="text-decoration: underline;"><span style="font-weight: normal;">(.*)<\/span><\/span>/gi,"$1"),e=e.replace(/<strong style="font-weight: normal;">(.*)<\/strong>/gi,"$1"),e=e.replace(/<em style="font-weight: normal;">(.*)<\/em>/gi,"$1"),e=e.replace(/<[^> ]*/g,function(e){return e.toLowerCase()}),e=e.replace(/<[^>]*>/g,function(e){return e=e.replace(/ [^=]+=/g,function(e){return e.toLowerCase()})}),e=e.replace(/<[^!][^>]*>/g,function(e){return e=e.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"')}),this.options.xhtml&&(e=e.replace(/<img([^>]+)(\s*[^\/])>(<\/img>)*/gi,"<img$1$2 />")),e=e.replace(/<p>(?:\s*)<p>/g,"<p>"),e=e.replace(/<\/p>\s*<\/p>/g,"</p>"),e=e.replace(/<pre[^>]*>.*?<\/pre>/gi,function(e){return e.replace(/<br ?\/?>/gi,"\n")}),e=e.trim()}while(e!=t);return e=this.cleanHtml(e)}}),MooEditable.Selection=new Class({initialize:function(e){this.win=e},getSelection:function(){return this.win.focus(),this.win.getSelection?this.win.getSelection():this.win.document.selection},getRange:function(){var e=this.getSelection();if(!e)return null;try{return e.rangeCount>0?e.getRangeAt(0):e.createRange?e.createRange():null}catch(t){return this.doc.body.createTextRange()}},setRange:function(e){if(e.select)Function.attempt(function(){e.select()});else{var t=this.getSelection();t.addRange&&(t.removeAllRanges(),t.addRange(e))}},selectNode:function(e,t){var i=this.getRange(),o=this.getSelection();return i.moveToElementText?Function.attempt(function(){i.moveToElementText(e),i.select()}):o.addRange?(t?i.selectNodeContents(e):i.selectNode(e),o.removeAllRanges(),o.addRange(i)):o.setBaseAndExtent(e,0,e,1),e},isCollapsed:function(){var e=this.getRange();return e.item?!1:0==e.boundingWidth||this.getSelection().isCollapsed},collapse:function(e){var t=this.getRange(),i=this.getSelection();t.select?(t.collapse(e),t.select()):e?i.collapseToStart():i.collapseToEnd()},getContent:function(){var e=this.getRange(),t=new Element("body");if(this.isCollapsed())return"";e.cloneContents?t.appendChild(e.cloneContents()):void 0!=e.item||void 0!=e.htmlText?t.set("html",e.item?e.item(0).outerHTML:e.htmlText):t.set("html",e.toString());var i=t.get("html");return i},getText:function(){var e=this.getRange(),t=this.getSelection();return this.isCollapsed()?"":e.text||(t.toString?t.toString():"")},getNode:function(){var e=this.getRange();if(!Browser.ie||Browser.version>=9){var t=null;if(e)for(t=e.commonAncestorContainer,e.collapsed||e.startContainer==e.endContainer&&e.startOffset-e.endOffset<2&&e.startContainer.hasChildNodes()&&(t=e.startContainer.childNodes[e.startOffset]);"element"!=typeOf(t);)t=t.parentNode;return document.id(t)}return document.id(e.item?e.item(0):e.parentElement())},insertContent:function(e){if(Browser.ie){var t=this.getRange();if(t.pasteHTML)t.pasteHTML(e),t.collapse(!1),t.select();else if(t.insertNode)if(t.deleteContents(),t.createContextualFragment)t.insertNode(t.createContextualFragment(e));else{var i=this.win.document,o=i.createDocumentFragment(),s=i.createElement("div");o.appendChild(s),s.outerHTML=e,t.insertNode(o)}}else this.win.document.execCommand("insertHTML",!1,e)}});var n={};MooEditable.Locale={define:function(e,t){return"null"!=typeOf(window.Locale)?Locale.define("en-US","MooEditable",e,t):void("object"==typeOf(e)?Object.merge(n,e):n[e]=t)},get:function(e){return"null"!=typeOf(window.Locale)?Locale.get("MooEditable."+e):e?n[e]:""}},MooEditable.Locale.define({ok:"OK",cancel:"Cancel",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",unorderedList:"Unordered List",orderedList:"Ordered List",indent:"Indent",outdent:"Outdent",undo:"Undo",redo:"Redo",removeHyperlink:"Remove Hyperlink",addHyperlink:"Add Hyperlink",selectTextHyperlink:"Please select the text you wish to hyperlink.",enterURL:"Enter URL",enterImageURL:"Enter image URL",addImage:"Add Image",toggleView:"Toggle View"}),MooEditable.UI={},MooEditable.UI.Toolbar=new Class({Implements:[Events,Options],options:{"class":""},initialize:function(e){this.setOptions(e),this.el=new Element("div",{"class":"mooeditable-ui-toolbar "+this.options["class"]}),this.items={},this.content=null},toElement:function(){return this.el},render:function(e){return this.content?this.el.adopt(this.content):this.content=e.map(function(e){return"|"==e?this.addSeparator():"/"==e?this.addLineSeparator():this.addItem(e)}.bind(this)),this},addItem:function(e){var t=this,i=MooEditable.Actions[e];if(i){var o=i.type||"button",s=i.options||{},n=new(MooEditable.UI[o.camelCase().capitalize()])(Object.append(s,{name:e,"class":e+"-item toolbar-item",title:i.title,onAction:t.itemAction.bind(t),tabindex:-1}));return this.items[e]=n,document.id(n).inject(this.el),n}},getItem:function(e){return this.items[e]},addSeparator:function(){return new Element("span.toolbar-separator").inject(this.el)},addLineSeparator:function(){return new Element("div.toolbar-line-separator").inject(this.el)},itemAction:function(){this.fireEvent("itemAction",arguments)},disable:function(e){return Object.each(this.items,function(t){t.name==e?t.activate():t.deactivate().disable()}),this},enable:function(){return Object.each(this.items,function(e){e.enable()}),this},show:function(){return this.el.setStyle("display",""),this},hide:function(){return this.el.setStyle("display","none"),this}}),!function(){var e="mac"===Browser.platform?"Cmd":"Ctrl";MooEditable.UI.Button=new Class({Implements:[Events,Options],options:{title:"",name:"",text:"Button","class":"",shortcut:"",mode:"icon"},initialize:function(e){this.setOptions(e),this.name=this.options.name,this.render()},toElement:function(){return this.el},render:function(){var t=this.options.shortcut?" ( "+e+"+"+this.options.shortcut.toUpperCase()+" )":"",i=this.options.name,o=this.options.icon||i,s=this.options.title||i,n=s+t;return this.el=new Element("button",{"class":"mooeditable-ui-button "+this.options["class"],title:n,tabindex:-1,html:'<span class="icon-'+o+' button-icon"></span><span class="button-text">'+s+"</span>",events:{click:this.click.bind(this),mousedown:function(e){e.preventDefault()}}}),"icon"!=this.options.mode&&this.el.addClass("mooeditable-ui-button-"+this.options.mode),this.active=!1,this.disabled=!1,Browser.ie&&this.el.addEvents({mouseenter:function(){this.addClass("hover")},mouseleave:function(){this.removeClass("hover")}}),this},click:function(e){e.preventDefault(),this.disabled||this.action(e)},action:function(){this.fireEvent("action",[this].concat(Array.from(arguments)))},enable:function(){return this.active&&this.el.removeClass("onActive"),this.disabled?(this.disabled=!1,this.el.removeClass("disabled").set({disabled:!1,opacity:1}),this):void 0},disable:function(){return this.disabled?void 0:(this.disabled=!0,this.el.addClass("disabled").set({disabled:!0,opacity:.4}),this)},activate:function(){return this.disabled?void 0:(this.active=!0,this.el.addClass("onActive"),this)},deactivate:function(){return this.active=!1,this.el.removeClass("onActive"),this}})}(),MooEditable.UI.Dialog=new Class({Implements:[Events,Options],options:{"class":"",contentClass:""},initialize:function(e,t){this.setOptions(t),this.html=e;var i=this;this.el=new Element("div",{"class":"mooeditable-ui-dialog "+i.options["class"],html:'<div class="dialog-content '+i.options.contentClass+'">'+e+"</div>",styles:{display:"none"},events:{click:i.click.bind(i)}})},toElement:function(){return this.el},click:function(){return this.fireEvent("click",arguments),this},open:function(){return this.el.setStyle("display",""),this.fireEvent("open",this),this},close:function(){return this.el.setStyle("display","none"),this.fireEvent("close",this),this}}),MooEditable.UI.AlertDialog=function(e){if(e){var t=e+' <button class="dialog-ok-button">'+MooEditable.Locale.get("ok")+"</button>";return new MooEditable.UI.Dialog(t,{"class":"mooeditable-alert-dialog",onOpen:function(){var e=this.el.getElement(".dialog-ok-button");(function(){e.focus()}).delay(10)},onClick:function(e){e.preventDefault(),"button"==e.target.tagName.toLowerCase()&&document.id(e.target).hasClass("dialog-ok-button")&&this.close()}})}},MooEditable.UI.PromptDialog=function(e,t,i){if(e){var o='<label class="dialog-label">'+e+' <input type="text" class="text dialog-input" value="'+t+'"></label> <button class="dialog-button dialog-ok-button">'+MooEditable.Locale.get("ok")+'</button><button class="dialog-button dialog-cancel-button">'+MooEditable.Locale.get("cancel")+"</button>";return new MooEditable.UI.Dialog(o,{"class":"mooeditable-prompt-dialog",onOpen:function(){var e=this.el.getElement(".dialog-input");(function(){e.focus(),e.select()}).delay(10)},onClick:function(e){if(e.preventDefault(),"button"==e.target.tagName.toLowerCase()){var o=document.id(e.target),s=this.el.getElement(".dialog-input");if(o.hasClass("dialog-cancel-button"))s.set("value",t),this.close();else if(o.hasClass("dialog-ok-button")){var n=s.get("value");s.set("value",t),this.close(),i&&i.attempt(n,this)}}}})}},MooEditable.Actions={bold:{title:MooEditable.Locale.get("bold"),options:{shortcut:"b"},states:{tags:["b","strong"],css:{"font-weight":"bold"}},events:{beforeToggleView:function(){if(Browser.firefox){var e=this.textarea.get("value"),t=e.replace(/<strong([^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>");e!=t&&this.textarea.set("value",t)}},attach:function(){if(Browser.firefox){var e=this.textarea.get("value"),t=e.replace(/<strong([^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>");e!=t&&(this.textarea.set("value",t),this.setContent(t))}}}},italic:{title:MooEditable.Locale.get("italic"),options:{shortcut:"i"},states:{tags:["i","em"],css:{"font-style":"italic"}},events:{beforeToggleView:function(){if(Browser.firefox){var e=this.textarea.get("value"),t=e.replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");e!=t&&this.textarea.set("value",t)}},attach:function(){if(Browser.firefox){var e=this.textarea.get("value"),t=e.replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");e!=t&&(this.textarea.set("value",t),this.setContent(t))}}}},underline:{title:MooEditable.Locale.get("underline"),options:{shortcut:"u"},states:{tags:["u"],css:{"text-decoration":"underline"}},events:{beforeToggleView:function(){if(Browser.firefox||Browser.ie){var e=this.textarea.get("value"),t=e.replace(/<span style="text-decoration: underline;"([^>]*)>/gi,"<u$1>").replace(/<\/span>/gi,"</u>");e!=t&&this.textarea.set("value",t)}},attach:function(){if(Browser.firefox||Browser.ie){var e=this.textarea.get("value"),t=e.replace(/<span style="text-decoration: underline;"([^>]*)>/gi,"<u$1>").replace(/<\/span>/gi,"</u>");e!=t&&(this.textarea.set("value",t),this.setContent(t))}}}},strikethrough:{title:MooEditable.Locale.get("strikethrough"),options:{shortcut:"s"},states:{tags:["s","strike"],css:{"text-decoration":"line-through"}}},insertunorderedlist:{title:MooEditable.Locale.get("unorderedList"),states:{tags:["ul"]},options:{icon:"list-ul"}},insertorderedlist:{title:MooEditable.Locale.get("orderedList"),states:{tags:["ol"]},options:{icon:"list-ol"}},indent:{title:MooEditable.Locale.get("indent"),states:{tags:["blockquote"]},options:{icon:"indent-right"}},outdent:{title:MooEditable.Locale.get("outdent"),options:{icon:"indent-left"}},undo:{title:MooEditable.Locale.get("undo"),options:{shortcut:"z"}},redo:{title:MooEditable.Locale.get("redo"),options:{shortcut:"y",icon:"repeat"}},unlink:{title:MooEditable.Locale.get("removeHyperlink")},createlink:{title:MooEditable.Locale.get("addHyperlink"),options:{shortcut:"l",icon:"link"},states:{tags:["a"]},dialogs:{alert:MooEditable.UI.AlertDialog.pass(MooEditable.Locale.get("selectTextHyperlink")),prompt:function(e){return MooEditable.UI.PromptDialog(MooEditable.Locale.get("enterURL"),"http://",function(t){e.execute("createlink",!1,t.trim())})}},command:function(){var e=this.selection,t=this.dialogs.createlink;if(e.isCollapsed()){var i=e.getNode();if("a"==i.get("tag")&&i.get("href")){e.selectNode(i);var s=t.prompt;s.el.getElement(".dialog-input").set("value",i.get("href")),s.open()}else t.alert.open()}else{var n=e.getText(),s=t.prompt;o.test(n)&&s.el.getElement(".dialog-input").set("value",n),s.open()}}},urlimage:{title:MooEditable.Locale.get("addImage"),options:{shortcut:"m",icon:"picture"},dialogs:{prompt:function(e){return MooEditable.UI.PromptDialog(MooEditable.Locale.get("enterImageURL"),"http://",function(t){e.execute("insertimage",!1,t.trim())})}},command:function(){this.dialogs.urlimage.prompt.open()}},toggleview:{title:MooEditable.Locale.get("toggleView"),command:function(){"textarea"==this.mode?this.toolbar.enable():this.toolbar.disable("toggleview"),this.toggleView()},options:{icon:"code"}}},MooEditable.Actions.Settings={},Element.Properties.mooeditable={get:function(){return this.retrieve("MooEditable")}},Element.implement({mooEditable:function(e){var t=this.get("mooeditable");return t||(t=new MooEditable(this,e)),t}});var a=null,r=null,l=null;window.addEvent("mousedown:relay(.mooeditable-resizer)",function(i,o){i.preventDefault(),a=o.getPrevious(),"none"==a.getStyle("display")&&(a=a.getPrevious()),r=a.getSize().y,l=i.client.y,"IFRAME"==a.tagName&&a.setStyle("visibility","hidden"),window.addEvents({mousemove:e,mouseup:t})})}(),MooEditable.UI.MenuList=new Class({Implements:[Events,Options],options:{title:"",name:"","class":"",list:[]},initialize:function(e){this.setOptions(e),this.name=this.options.name,this.render()},toElement:function(){return this.el},render:function(){var e=this,t="";return this.options.list.each(function(e){t+='<option value="{value}" style="{style}">{text}</option>'.substitute(e)}),this.el=new Element("select",{"class":e.options["class"],title:e.options.title,tabindex:-1,html:t,styles:{height:"21px"},events:{change:e.change.bind(e)}}),this.disabled=!1,Browser.ie&&this.el.addEvents({mouseenter:function(){this.addClass("hover")},mouseleave:function(){this.removeClass("hover")}}),this},change:function(e){if(e.preventDefault(),!this.disabled){var t=e.target.value;this.action(t)}},action:function(){this.fireEvent("action",[this].concat(Array.from(arguments)))},enable:function(){return this.disabled?(this.disabled=!1,this.el.set("disabled",!1).removeClass("disabled").set({disabled:!1,opacity:1}),this):void 0},disable:function(){return this.disabled?void 0:(this.disabled=!0,this.el.set("disabled",!0).addClass("disabled").set({disabled:!0,opacity:.4}),this)},activate:function(e){if(!this.disabled){var t=0;return e&&this.options.list.each(function(i,o){i.value==e&&(t=o)}),this.el.selectedIndex=t,this}},deactivate:function(){return this.el.selectedIndex=0,this.el.removeClass("onActive"),this}}),MooEditable.Locale.define({blockFormatting:"Format de block",paragraph:"Paragraphe",heading1:"En-tête 1",heading2:"En-tête 2",heading3:"En-tête 3",heading4:"En-tête 4",alignLeft:"Align Left",alignRight:"Align Right",alignCenter:"Align Center",alignJustify:"Align Justify",removeFormatting:"Remove Formatting",insertHorizontalRule:"Insert Horizontal Rule"}),Object.append(MooEditable.Actions,{formatBlock:{title:MooEditable.Locale.get("blockFormatting"),type:"menu-list",options:{list:[{text:MooEditable.Locale.get("paragraph"),value:"p"},{text:MooEditable.Locale.get("heading2"),value:"h2",style:"font-size:18px; font-weight:bold;"},{text:MooEditable.Locale.get("heading3"),value:"h3",style:"font-size:14px; font-weight:bold;"},{text:MooEditable.Locale.get("heading4"),value:"h4",style:"font-size:12px; font-weight:bold;"}]},states:{tags:["p","h2","h3","h4"]},command:function(e,t){var i="<"+t+">";this.focus(),this.execute("formatBlock",!1,i)}},justifyleft:{title:MooEditable.Locale.get("alignLeft"),states:{css:{"text-align":"left"}},command:function(){var e=this.selection.getNode(),t=e.tagName;"IMG"==t||"OBJECT"==t?e.align="left":"P"==t&&(e.align="")},options:{icon:"align-left"}},justifyright:{title:MooEditable.Locale.get("alignRight"),states:{css:{"text-align":"right"}},command:function(){var e=this.selection.getNode(),t=e.tagName;"IMG"==t||"OBJECT"==t?e.align="right":"P"==t&&(e.align="right")},options:{icon:"align-right"}},justifycenter:{title:MooEditable.Locale.get("alignCenter"),states:{tags:["center"],css:{"text-align":"center"}},options:{icon:"align-center"}},justifyfull:{title:MooEditable.Locale.get("alignJustify"),states:{css:{"text-align":"justify"}},options:{icon:"align-justify"}},removeformat:{title:MooEditable.Locale.get("removeFormatting"),options:{icon:"eraser"}},insertHorizontalRule:{title:MooEditable.Locale.get("insertHorizontalRule"),states:{tags:["hr"]},command:function(){this.selection.insertContent("<hr>")
}}}),MooEditable.UI.PasteDialog=new Class({Extends:MooEditable.UI.Dialog,initialize:function(e){this.editor=e,this.unique=Math.random(),this.dummy_el=new Element("div",{styles:{display:"none"}})},toElement:function(){return this.dummy_el},close:function(){return this.adjust&&(this.adjust.destroy(),this.adjust=null),this.fireEvent("close",this),this},open:function(){if(this.adjust)return this.close();var e=this.editor,t=e.toolbar.items.paste.el,i=t.getCoordinates();adjust=new Element("div",{"class":"mooeditable-ui-dialog mooeditable-paste-dialog",styles:{position:"absolute",width:"64ex",left:i.left+i.width/2,"margin-left":"-32ex",top:i.bottom+20}}),this.adjust=adjust;var o,s,n=new Element("div",{"class":"mooeditable-ui-dialog-action-frame"});n.adopt(s=new Element("button.btn-primary",{type:"button",html:"Coller"}));var a=new Element("div",{"class":"mooeditable-ui-dialog-contents-frame"});a.adopt(o=new Element("textarea",{rows:10})),adjust.adopt(a,n),s.addEvent("click",function(){var t=o.get("value");t&&(t=t.replace(/\r?\n\r?\n/gi,"</p><p>"),t=t.replace(/\r?\n/gi,"<br />"),t="<p>"+t+"</p>",e.selection.insertContent(t)),this.close()}.bind(this)),document.body.appendChild(adjust),o.focus()}}),MooEditable.Actions.paste={title:"Paste text, stripping formating",dialogs:{prompt:function(e){return new MooEditable.UI.PasteDialog(e)}},command:function(){this.dialogs.paste.prompt.open()}},!function(){function e(e,t){return e=e.replace(/<(\w+)([^>]*)>\s+/g,"<$1$2>\n"),e=e.replace(/>\s+</g,">\n<"),t?this.options.paragraphise?(e="<p>"+e+"</p>",e=e.replace(/\n\n/g,"</p><p>"),e=e.replace(/<p>\s<\/p>/gi,"")):e=e.replace(/\n/g,"<br />"):(e=e.replace(/<html[^>]*?>(.*)/gim,"$1"),e=e.replace(/<\/html>/gi,""),e=e.replace(/<body[^>]*?>(.*)/gi,"$1"),e=e.replace(/<\/body>/gi,""),e=e.replace(/<style[^>]*?>[\s\S]*?<\/style[^>]*>/gi,""),e=e.replace(/<(?:meta|link)[^>]*>\s*/gi,""),e=e.replace(/<\\?\?xml[^>]*>/gi,""),e=e.replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,""),e=e.replace(/<o:p>\s*<\/o:p>/g,""),e=e.replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;"),e=e.replace(/<\/?\w+:[^>]*>/gi,""),e=e.replace(/<\!--[\s\S]*?-->/g,""),e=e.replace(/<\!\[[\s\S]*?\]>/g,""),e=e.replace(/\s*mso-[^:]+:[^;"']+;?/gi,""),e=e.replace(/<(\w[^>]*) style='([^\']*)'([^>]*)/gim,"<$1$3"),e=e.replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gim,"<$1$3"),e=e.replace(/\s*margin: 0cm 0cm 0pt\s*;/gi,""),e=e.replace(/\s*margin: 0cm 0cm 0pt\s*"/gi,'"'),e=e.replace(/\s*text-indent: 0cm\s*;/gi,""),e=e.replace(/\s*text-indent: 0cm\s*"/gi,'"'),e=e.replace(/\s*text-align: [^\s;]+;?"/gi,'"'),e=e.replace(/\s*page-break-before: [^\s;]+;?"/gi,'"'),e=e.replace(/\s*font-variant: [^\s;]+;?"/gi,'"'),e=e.replace(/\s*tab-stops:[^;"']*;?/gi,""),e=e.replace(/\s*tab-stops:[^"']*/gi,""),e=e.replace(/\s*face="[^"']*"/gi,""),e=e.replace(/\s*face=[^ >]*/gi,""),e=e.replace(/\s*font-family:[^;"']*;?/gi,""),e=e.replace(/\s*font-size:[^;"']*;?/gi,""),e=e.replace(/\<[\w[^>]*\sclass="([^"]+)"/,function(e,t){return e.replace(t,t.replace(/Mso[^\s]+/gi,"").trim())}),e=e.replace(/<(\w+)[^>]*\sstyle="[^"']*display\s?:\s?none[\s \S]*?<\/\1>/gi,""),e=e.replace(/\s*style='\s*'/gi,""),e=e.replace(/\s*style="\s*"/gi,""),e=e.replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/gi,"&nbsp;"),e=e.replace(/<span\s*[^>]*><\/span>/gi,""),e=e.replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3"),e=e.replace(/<(font|i|span|strike|u)(\s*>|\s+[^>]+>)/gi,""),e=e.replace(/<\/(font|i|span|strike|u)>/gi,""),e=e.replace(/<h\d>\s*<\/h\d>/gi,""),e=e.replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3"),e=e.replace(/<(\w[^>]*) onmouseover="([^\"']*)"([^>]*)/gi,"<$1$3"),e=e.replace(/<(\w[^>]*) onmouseout="([^\"']*)"([^>]*)/gi,"<$1$3"),e=e.replace(/<(h\d)><em>([\s\S]*?)<\/em><\/\1>/gi,"<$1>$2</$1>"),e=e.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>"),e=e.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>"),e=e.replace(/<\s+[^>]*>/gi,""),e=e.replace(/<(td|th)([^>]*)>\s*<\/(td|th)>/gi,"<$1$2>&nbsp;</$1>"),e=e.replace(/<br>/gi,"<br />"),e=e.replace(/^(\s*<br \/>\s*)+|(\s*<br \/>\s*)+$/gi,""),e=e.replace(/(\s*<br \/>\s*)+<\/p>/gim,"</p>"),e=e.replace(/<((?!th|td)\w+)[^>]*>\s*&nbsp;\s*<\/\1>/gi,""),e=e.replace(/<p>\s<\/p>/gi,""),e=e.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,function(e,t){return t.match(/^iframe$/i)?e:""}),e=e.trim()),e=e.replace(/src="([^"]+)/gi,function(e,t){return t.match(/^(http:\/\/|\/)/)||(t=this.baseHREF+"/"+t),'src="'+t}.bind(this))}try{return void(module.exports.cleanHtml=e)}catch(t){}MooEditable=Class.refactor(MooEditable,{attach:function(){var e=this.previous();return this.doc.body.addListener("paste",this.cleanPaste.bind(this)),e},cleanPaste:function(e){var t=e.clipboardData&&e.clipboardData.getData?e.clipboardData.getData("text/html"):window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):!1;return t&&""!==t.trim()||!e.clipboardData||!e.clipboardData.getData||(t=e.clipboardData.getData("Text")),t?(this.selection.insertContent(window.clipboardData?this.cleanHtml(t,1):this.cleanHtml(t)),e.preventDefault(),e.stopPropagation()):(this.selection.insertContent('<span id="INSERTION_MARKER">&nbsp;</span>'),this.txtMarked=this.doc.body.get("html"),this.doc.body.set("html",""),this.replaceMarkerWithPastedText.delay(5,this)),this},replaceMarkerWithPastedText:function(){var e=this.cleanHtml(this.doc.body.get("html"));return this.doc.body.set("html",this.txtMarked),this.selection.selectNode(this.doc.body.getElementById("INSERTION_MARKER")),this.selection.insertContent(e),this},cleanHtml:function(t,i){return e.call(this,t,i)}})}(),MooEditable.Actions.outline={title:"Outline blocks",command:function(){this.doc.body.toggleClass("mooeditable-outline")},options:{icon:"info"}},MooEditable.UI.ImageDialog=function(){var e="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////IiIiHNlGNAAAAAF0Uk5TAEDm2GYAAAAeSURBVHjaYmBkYMCPKJVnZBi1YtSKUSuGphUAAQYAxEkBVsmDp6QAAAAASUVORK5CYII=";return new Class({Extends:MooEditable.UI.Dialog,initialize:function(e){this.editor=e,this.unique=Math.random(),this.dummy_el=new Element("div",{styles:{display:"none"}})},toElement:function(){return this.dummy_el},click:function(){return this.fireEvent("click",arguments),this},close:function(){return this.popover&&this.popover.hide(),this.fireEvent("close",this),this},open:function(){this.node=this.editor.selection.getNode(),this.node&&"img"==this.node.get("tag")||(this.node=this.editor.doc.createElement("img"),this.node.src=e,this.editor.selection.getRange().insertNode(this.node)),this.node.addEvent("load",function(){this.popover&&this.popover.reposition()}.bind(this)),this.previousImage=this.node.get("src"),this.popover?(this.popover.attachAnchor(this.node),this.popover.adjust.setValue(this.node),this.popover.show()):(this.fetchAdjustOperation||(this.fetchAdjustOperation=new Request.Widget("adjust-thumbnail/popup",this.setupPopover.bind(this))),this.fetchAdjustOperation.get({selected:this.node.get("src")}))},setupPopover:function(e){var t=this.popover=new Icybee.Widget.AdjustPopover(e,{anchor:this.node,iframe:this.editor.iframe}),i=t.getAdjust();t.addEvent("action",function(e){var t=e.action,i=this.node.src;"cancel"==t?this.node.src=i=this.previousImage:"remove"==t&&(i=null),(!i||i.match(/^data:/))&&(this.node.destroy(),delete this.node),this.close()}.bind(this)),i.setValue(this.node),i.addEvent("change",function(e){var t=e.options,i=this.node;i.src=this.editor.baseHREF+e.url,i.set("data-nid",e.nid),t.lightbox?i.set("data-lightbox",!0):i.removeAttribute("data-lightbox"),t.width&&"surface"!=t.method&&"constrained"!=t.method?i.set("width",t.width):i.removeAttribute("width"),t.height&&"surface"!=t.method&&"constrained"!=t.method?i.set("height",t.height):i.removeAttribute("height")}.bind(this)),t.show()}})}(),MooEditable.Actions.image={title:"Add/Edit Image",options:{shortcut:"m",icon:"picture"},dialogs:{prompt:function(e){return new MooEditable.UI.ImageDialog(e)}},command:function(){this.dialogs.image.prompt.open()}},window.addEvent("brickrouge.update",function(){$$("textarea.moo").each(function(e){if(!e.retrieve("mooeditable")){var t=e.get("dataset");t.externalCss&&(t.externalCSS=JSON.decode(t.externalCss)),t.baseUrl&&(t.baseURL=t.baseUrl),e.mooEditable(t),e.store("mooeditable",!0)}})});