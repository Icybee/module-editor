(function(){function c(a){a=Math.max(n+a.client.y-p,100);var d;d="IFRAME"==k.tagName?k.getNext():k.getPrevious();k.setStyle("height",a);d.setStyle("height",a)}function b(a){window.removeEvent("mousemove",c);window.removeEvent("mouseup",b);"IFRAME"==k.tagName&&k.setStyle("visibility","");k=null}var h=/^(H[1-6]|HR|P|DIV|ADDRESS|PRE|FORM|TABLE|LI|OL|UL|TD|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD|SCRIPT|NOSCRIPT|STYLE|ARTICLE|ASIDE|DETAILS|FIGCAPTION|FIGURE|FOOTER|HEADER|HGROUP|NAV|SECTION)$/i,e=/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i,
f=/<(script|noscript|style)[\u0000-\uFFFF]*?<\/(script|noscript|style)>/g;this.MooEditable=new Class({Implements:[Events,Options],options:{toolbar:!0,cleanup:!0,paragraphise:!0,xhtml:!0,semantics:!0,actions:"bold italic underline strikethrough | insertunorderedlist insertorderedlist indent outdent | undo redo | createlink unlink | urlimage | toggleview",handleSubmit:!0,handleLabel:!0,disabled:!1,baseCSS:"html{ height: 100%; cursor: text; } body{ font-family: sans-serif; }",extraCSS:"",externalCSS:"",
html:'<!DOCTYPE html><html id="{HTMLID}" lang="{LANGUAGE}"><head><meta charset="UTF-8">{BASEHREF}<style>{BASECSS} {EXTRACSS}</style>{EXTERNALCSS}</head><body class="editor-rte"></body></html>',rootElement:"p",baseURL:"",dimensions:null,htmlId:"wysiwyg"},initialize:function(a,d){if("contentEditable"in document.body||"designMode"in document)this.setOptions(d),this.textarea=document.id(a),this.textarea.store("MooEditable",this),this.textarea.addEvent("change",function(a){this.setContent(this.textarea.get("value"))}.bind(this)),
this.actions=this.options.actions.clean().split(" "),this.keys={},this.dialogs={},this.protectedElements=[],this.actions.each(function(a){var d=MooEditable.Actions[a];if(d){if(d.options){var b=d.options.shortcut;b&&(this.keys[b]=a)}d.dialogs&&Object.each(d.dialogs,function(d,b){d=d.attempt(this);d.name=a+":"+b;"object"!=typeOf(this.dialogs[a])&&(this.dialogs[a]={});this.dialogs[a][b]=d},this);d.events&&Object.each(d.events,function(a,d){this.addEvent(d,a)},this)}}.bind(this)),this.render()},toElement:function(){return this.textarea},
render:function(){var a=this,d=this.options.dimensions||this.textarea.getSize();this.container=new Element("div",{id:this.textarea.id?this.textarea.id+"-mooeditable-container":null,"class":"mooeditable-container"});this.textarea.addClass("mooeditable-textarea").setStyle("height",d.y);this.iframe=new IFrame({"class":"mooeditable-iframe",frameBorder:0,src:'javascript:""',styles:{height:Math.max(100,d.y)}});this.resizer=new Element("div.mooeditable-resizer");this.toolbar=new MooEditable.UI.Toolbar({onItemAction:function(){var d=
Array.from(arguments);a.action(d[0].name,d)}});this.attach.delay(1,this);this.options.handleLabel&&this.textarea.id&&$$('label[for="'+this.textarea.id+'"]').addEvent("click",function(d){"iframe"==a.mode&&(d.preventDefault(),a.focus())});this.options.handleSubmit&&(this.form=this.textarea.getParent("form"))&&this.form.addEvent("submit",function(){"iframe"==a.mode&&a.saveContent()});this.fireEvent("render",this)},attach:function(){var a=this;this.mode="iframe";this.editorDisabled=!1;this.container.wraps(this.textarea);
this.textarea.setStyle("display","none");this.iframe.setStyle("display","").inject(this.textarea,"before");this.resizer.inject(this.textarea,"after");Object.each(this.dialogs,function(d,b){Object.each(d,function(d){document.id(d).inject(a.iframe,"before");var m;d.addEvents({open:function(){m=a.selection.getRange();a.editorDisabled=!0;a.toolbar.disable(b);a.fireEvent("dialogOpen",this)},close:function(){a.toolbar.enable();a.editorDisabled=!1;a.focus();m&&a.selection.setRange(m);a.fireEvent("dialogClose",
this)}})})});this.win=this.iframe.contentWindow;this.doc=this.win.document;Browser.firefox&&(this.doc.designMode="On");var d="";this.options.externalCSS&&("array"==typeOf(this.options.externalCSS)?this.options.externalCSS.each(function(a){d+='<link rel="stylesheet" href="'+a+'">\n'}):d='<link rel="stylesheet" href="'+this.options.externalCSS+'">');this.baseHREF=document.location.protocol+"//"+document.location.hostname;document.location.port&&(this.baseHREF+=":"+document.location.port);var b=this.options.html.substitute({BASECSS:this.options.baseCSS,
EXTRACSS:this.options.extraCSS,EXTERNALCSS:d,BASEHREF:'<base href="'+this.baseHREF+'" />',HTMLID:this.options.htmlId,LANGUAGE:this.textarea.get("lang")||document.html.get("lang")});this.doc.open();this.doc.write(b);this.doc.close();Browser.ie?this.doc.body.contentEditable=!0:this.doc.designMode="On";Object.append(this.win,new Window);Object.append(this.doc,new Document);if(Browser.Element){var b=this.win.Element.prototype,l;for(l in Element)l.test(/^[A-Z]|\$|prototype|mooEditable/)||(b[l]=Element.prototype[l])}else document.id(this.doc.body);
this.setContent(this.textarea.get("value"));this.doc.addEvents({mouseup:this.editorMouseUp.bind(this),mousedown:this.editorMouseDown.bind(this),mouseover:this.editorMouseOver.bind(this),mouseout:this.editorMouseOut.bind(this),mouseenter:this.editorMouseEnter.bind(this),mouseleave:this.editorMouseLeave.bind(this),contextmenu:this.editorContextMenu.bind(this),click:this.editorClick.bind(this),dblclick:this.editorDoubleClick.bind(this),keypress:this.editorKeyPress.bind(this),keyup:this.editorKeyUp.bind(this),
keydown:this.editorKeyDown.bind(this),focus:this.editorFocus.bind(this),blur:this.editorBlur.bind(this)});this.win.addEvents({focus:this.editorFocus.bind(this),blur:this.editorBlur.bind(this),load:function(){this.actions.each(function(a){(a=MooEditable.Actions[a])&&a.load&&a.load(this)},this)}.bind(this)});["cut","copy","paste"].each(function(d){a.doc.body.addListener(d,a["editor"+d.capitalize()].bind(a))});this.textarea.addEvent("keypress",this.textarea.retrieve("mooeditable:textareaKeyListener",
this.keyListener.bind(this)));Browser.firefox2&&this.doc.addEvent("focus",function(){a.win.fireEvent("focus").focus()});this.doc.addEventListener&&this.doc.addEventListener("focus",function(){a.win.fireEvent("focus")},!0);if(!Browser.ie&&!Browser.opera){var c=function(){a.execute("styleWithCSS",!1,!1);a.doc.removeEvent("focus",c)};this.win.addEvent("focus",c)}this.options.toolbar&&(document.id(this.toolbar).inject(this.container,"top"),this.toolbar.render(this.actions));this.options.disabled&&this.disable();
this.selection=new MooEditable.Selection(this.win);this.oldContent=this.getContent();this.fireEvent("attach",this);return this},detach:function(){this.saveContent();this.textarea.setStyle("display","").removeClass("mooeditable-textarea").inject(this.container,"before");this.textarea.removeEvent("keypress",this.textarea.retrieve("mooeditable:textareaKeyListener"));this.container.dispose();this.fireEvent("detach",this);return this},enable:function(){this.editorDisabled=!1;this.toolbar.enable();return this},
disable:function(){this.editorDisabled=!0;this.toolbar.disable();return this},editorFocus:function(a){this.oldContent="";this.fireEvent("editorFocus",[a,this])},editorBlur:function(a){this.oldContent=this.saveContent().getContent();this.fireEvent("editorBlur",[a,this])},editorMouseUp:function(a){this.editorDisabled?a.stop():(this.options.toolbar&&this.checkStates(),this.fireEvent("editorMouseUp",[a,this]))},editorMouseDown:function(a){this.editorDisabled?a.stop():this.fireEvent("editorMouseDown",
[a,this])},editorMouseOver:function(a){this.editorDisabled?a.stop():this.fireEvent("editorMouseOver",[a,this])},editorMouseOut:function(a){this.editorDisabled?a.stop():this.fireEvent("editorMouseOut",[a,this])},editorMouseEnter:function(a){this.editorDisabled?a.stop():this.fireEvent("editorMouseEnter",[a,this])},editorMouseLeave:function(a){this.editorDisabled?a.stop():this.fireEvent("editorMouseLeave",[a,this])},editorContextMenu:function(a){this.editorDisabled?a.stop():this.fireEvent("editorContextMenu",
[a,this])},editorClick:function(a){if(Browser.safari||Browser.chrome){var d=a.target;"img"==Element.get(d,"tag")&&(this.options.baseURL&&(console.log("src: %s (%s)",d.getProperty("src"),d.getProperty("src").match("/https?:///")),d.getProperty("src").match("/https?:///")||d.setProperty("src",this.options.baseURL+d.getProperty("src"))),this.selection.selectNode(d),this.checkStates())}this.fireEvent("editorClick",[a,this])},editorDoubleClick:function(a){this.fireEvent("editorDoubleClick",[a,this])},
editorKeyPress:function(a){this.editorDisabled?a.stop():(this.keyListener(a),this.fireEvent("editorKeyPress",[a,this]))},editorKeyUp:function(a){if(this.editorDisabled)a.stop();else{var d=a.code;this.options.toolbar&&(/^enter|left|up|right|down|delete|backspace$/i.test(a.key)||33<=d&&36>=d||45==d||a.meta||a.control)&&(Browser.ie6?(clearTimeout(this.checkStatesDelay),this.checkStatesDelay=this.checkStates.delay(500,this)):this.checkStates());this.fireEvent("editorKeyUp",[a,this])}},editorKeyDown:function(a){if(this.editorDisabled)a.stop();
else{if("enter"==a.key)if(this.options.paragraphise)if(a.shift&&(Browser.safari||Browser.chrome)){var d=this.selection,b=d.getRange(),l=this.doc.createElement("br");b.insertNode(l);b.setStartAfter(l);b.setEndAfter(l);d.setRange(b);if(d.getSelection().focusNode==l.previousSibling){var b=this.doc.createTextNode("\u00a0"),c=l.parentNode;(l=l.nextSibling)?c.insertBefore(b,l):c.appendChild(b);d.selectNode(b);d.collapse(1)}this.win.scrollTo(0,Element.getOffsets(d.getRange().startContainer).y);a.preventDefault()}else{if(Browser.firefox||
Browser.safari||Browser.chrome)d=this.selection.getNode(),Element.getParents(d).include(d).some(function(a){return a.nodeName.test(h)})||this.execute("insertparagraph")}else Browser.ie&&(b=this.selection.getRange(),d=this.selection.getNode(),b&&"li"!=d.get("tag")&&(this.selection.insertContent("<br>"),this.selection.collapse(!1)),a.preventDefault());Browser.opera&&((d=a.control||a.meta)&&"x"==a.key?this.fireEvent("editorCut",[a,this]):d&&"c"==a.key?this.fireEvent("editorCopy",[a,this]):(d&&"v"==a.key||
a.shift&&45==a.code)&&this.fireEvent("editorPaste",[a,this]));this.fireEvent("editorKeyDown",[a,this])}},editorCut:function(a){this.editorDisabled?a.stop():this.fireEvent("editorCut",[a,this])},editorCopy:function(a){this.editorDisabled?a.stop():this.fireEvent("editorCopy",[a,this])},editorPaste:function(a){this.editorDisabled?a.stop():this.fireEvent("editorPaste",[a,this])},keyListener:function(a){("mac"===Browser.platform?a.meta:a.control)&&this.keys[a.key]&&(a.preventDefault(),this.toolbar.getItem(this.keys[a.key]).action(a))},
focus:function(){("iframe"==this.mode?this.win:this.textarea).focus();this.fireEvent("focus",this);return this},action:function(a,d){var b=MooEditable.Actions[a];b.command&&"function"==typeOf(b.command)?b.command.apply(this,d):(this.focus(),this.execute(a,!1,d),"iframe"==this.mode&&this.checkStates())},execute:function(a,d,b){if(!this.busy)return this.busy=!0,this.doc.execCommand(a,d,b),this.saveContent(),this.busy=!1},toggleView:function(){this.fireEvent("beforeToggleView",this);"textarea"==this.mode?
(this.mode="iframe",this.iframe.setStyle("display",""),this.setContent(this.textarea.value),this.textarea.setStyle("display","none")):(this.saveContent(),this.mode="textarea",this.textarea.setStyle("display",""),this.textarea.setStyle("visibility","visible"),this.iframe.setStyle("display","none"));this.fireEvent("toggleView",this);this.focus.delay(10,this);return this},getContent:function(){var a=this.protectedElements,d=this.doc.body.get("html").replace(/\x3c!-- mooeditable:protect:([0-9]+) --\x3e/g,
function(d,b){return a[b.toInt()]});return this.cleanup(this.ensureRootElement(d))},setContent:function(a){var d=this.protectedElements;a=a.replace(f,function(a){d.push(a);return"\x3c!-- mooeditable:protect:"+(d.length-1)+" --\x3e"});a=this.manageSrcAttribute(a);this.doc.body.set("html",this.ensureRootElement(a));return this},saveContent:function(){var a;a="iframe"==this.mode?this.getContent():this.textearea.innerHTML;a=a.replace(new RegExp('="'+this.baseHREF,"gi"),'="');this.textarea.set("value",
a);return this},manageSrcAttribute:function(a){var d=this.href;return a.replace(/src="([^"]+)/gi,function(a,b){b.match(/^(https?:\/\/|\/)/)||(b=d+b);return'src="'+b})},ensureRootElement:function(a){if(this.options.rootElement){a=new Element("div",{html:a.trim()});for(var d=-1,b=!1,c="",e=a.childNodes.length,f=0;f<e;f++){var g=a.childNodes[f],k=g.nodeName;k.test(h)||"#comment"===k?b=!0:"#text"===k?g.nodeValue.trim()&&(0>d&&(d=f),c+=g.nodeValue):(0>d&&(d=f),c+=(new Element("div")).adopt($(g).clone()).get("html"));
f==e-1&&(b=!0);if(0<=d&&b){b=new Element(this.options.rootElement,{html:c});a.replaceChild(b,a.childNodes[d]);for(d+=1;d<f;d++)a.removeChild(a.childNodes[d]),e--,f--,d--;d=-1;b=!1;c=""}}a=a.get("html").replace(/\n\n/g,"")}return a},checkStates:function(){var a=this.selection.getNode();a&&"element"==typeOf(a)&&this.actions.each(function(d){var b=this.toolbar.getItem(d);if(b){b.deactivate();var c=MooEditable.Actions[d].states;if(c)if("function"==typeOf(c))c.attempt([document.id(a),b],this);else{try{if(this.doc.queryCommandState(d)){b.activate();
return}}catch(f){}if(c.tags){d=a;do{var e=d.tagName.toLowerCase();if(c.tags.contains(e)){b.activate(e);break}}while(null!=(d=Element.getParent(d)))}if(c.css){d=a;do{var e=!1,g;for(g in c.css){var k=c.css[g];d.style[g.camelCase()].contains(k)&&(b.activate(k),e=!0)}if(e||d.tagName.test(h))break}while(null!=(d=Element.getParent(d)))}}}}.bind(this))},cleanup:function(a){if(!this.options.cleanup)return a.trim();do{var d=a;this.options.baseURL&&(a=a.replace('="'+this.options.baseURL,'="/'));a=a.replace(/<br class\="webkit-block-placeholder">/gi,
"<br />");a=a.replace(/<span class="Apple-style-span">(.*)<\/span>/gi,"$1");a=a.replace(/ class="Apple-style-span"/gi,"");a=a.replace(/<span style="">/gi,"");a=a.replace(/<p>\s*<br ?\/?>\s*<\/p>/gi,"<p>\u00a0</p>");a=a.replace(/<p>(&nbsp;|\s)*<\/p>/gi,"<p>\u00a0</p>");this.options.semantics||(a=a.replace(/\s*<br ?\/?>\s*<\/p>/gi,"</p>"));this.options.xhtml&&(a=a.replace(/<br>/gi,"<br />"));if(this.options.semantics){Browser.ie&&(a=a.replace(/<li>\s*<div>(.+?)<\/div><\/li>/g,"<li>$1</li>"));if(Browser.safari||
Browser.chrome)a=a.replace(/^([\w\s]+.*?)<div>/i,"<p>$1</p><div>"),a=a.replace(/<div>(.+?)<\/div>/ig,"<p>$1</p>");Browser.ie||(a=a.replace(/<p>[\s\n]*(<(?:ul|ol)>.*?<\/(?:ul|ol)>)(.*?)<\/p>/ig,"$1<p>$2</p>"),a=a.replace(/<\/(ol|ul)>\s*(?!<(?:p|ol|ul|img).*?>)((?:<[^>]*>)?\w.*)$/g,"</$1><p>$2</p>"));a=a.replace(/<br[^>]*><\/p>/g,"</p>");a=a.replace(/<p([^>]*)>(.*?)<\/p>(?!\n)/g,"<p$1>$2</p>\n");a=a.replace(/<\/(ul|ol|p)>(?!\n)/g,"</$1>\n");a=a.replace(/><li>/g,">\n\t<li>");a=a.replace(/([^\n])<\/(ol|ul)>/g,
"$1\n</$2>");a=a.replace(/([^\n])<img/ig,"$1\n<img");a=a.replace(/^\s*$/g,"")}a=a.replace(/<br ?\/?>$/gi,"");a=a.replace(/^<br ?\/?>/gi,"");this.options.paragraphise&&(a=a.replace(/(h[1-6]|p|div|address|pre|li|ol|ul|blockquote|center|dl|dt|dd)><br ?\/?>/gi,"$1>"));a=a.replace(/<br ?\/?>\s*<\/(h1|h2|h3|h4|h5|h6|li|p)/gi,"</$1");a=a.replace(/<span style="font-weight: bold;">(.*)<\/span>/gi,"<strong>$1</strong>");a=a.replace(/<span style="font-style: italic;">(.*)<\/span>/gi,"<em>$1</em>");a=a.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,
"<strong>$1</strong>");a=a.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>");a=a.replace(/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration: underline;">$1</span>');a=a.replace(/<strong><span style="font-weight: normal;">(.*)<\/span><\/strong>/gi,"$1");a=a.replace(/<em><span style="font-weight: normal;">(.*)<\/span><\/em>/gi,"$1");a=a.replace(/<span style="text-decoration: underline;"><span style="font-weight: normal;">(.*)<\/span><\/span>/gi,"$1");a=a.replace(/<strong style="font-weight: normal;">(.*)<\/strong>/gi,
"$1");a=a.replace(/<em style="font-weight: normal;">(.*)<\/em>/gi,"$1");a=a.replace(/<[^> ]*/g,function(a){return a.toLowerCase()});a=a.replace(/<[^>]*>/g,function(a){return a=a.replace(/ [^=]+=/g,function(a){return a.toLowerCase()})});a=a.replace(/<[^!][^>]*>/g,function(a){return a=a.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"')});this.options.xhtml&&(a=a.replace(/<img([^>]+)(\s*[^\/])>(<\/img>)*/gi,"<img$1$2 />"));a=a.replace(/<p>(?:\s*)<p>/g,"<p>");a=a.replace(/<\/p>\s*<\/p>/g,"</p>");a=a.replace(/<pre[^>]*>.*?<\/pre>/gi,
function(a){return a.replace(/<br ?\/?>/gi,"\n")});a=a.trim()}while(a!=d);return a=this.cleanHtml(a)}});MooEditable.Selection=new Class({initialize:function(a){this.win=a},getSelection:function(){this.win.focus();return this.win.getSelection?this.win.getSelection():this.win.document.selection},getRange:function(){var a=this.getSelection();if(!a)return null;try{return 0<a.rangeCount?a.getRangeAt(0):a.createRange?a.createRange():null}catch(d){return this.doc.body.createTextRange()}},setRange:function(a){if(a.select)Function.attempt(function(){a.select()});
else{var d=this.getSelection();d.addRange&&(d.removeAllRanges(),d.addRange(a))}},selectNode:function(a,d){var b=this.getRange(),c=this.getSelection();b.moveToElementText?Function.attempt(function(){b.moveToElementText(a);b.select()}):c.addRange?(d?b.selectNodeContents(a):b.selectNode(a),c.removeAllRanges(),c.addRange(b)):c.setBaseAndExtent(a,0,a,1);return a},isCollapsed:function(){var a=this.getRange();return a.item?!1:0==a.boundingWidth||this.getSelection().isCollapsed},collapse:function(a){var d=
this.getRange(),b=this.getSelection();d.select?(d.collapse(a),d.select()):a?b.collapseToStart():b.collapseToEnd()},getContent:function(){var a=this.getRange(),b=new Element("body");if(this.isCollapsed())return"";a.cloneContents?b.appendChild(a.cloneContents()):void 0!=a.item||void 0!=a.htmlText?b.set("html",a.item?a.item(0).outerHTML:a.htmlText):b.set("html",a.toString());return b.get("html")},getText:function(){var a=this.getRange(),b=this.getSelection();return this.isCollapsed()?"":a.text||(b.toString?
b.toString():"")},getNode:function(){var a=this.getRange();if(!Browser.ie||9<=Browser.version){var b=null;if(a)for(b=a.commonAncestorContainer,a.collapsed||a.startContainer==a.endContainer&&2>a.startOffset-a.endOffset&&a.startContainer.hasChildNodes()&&(b=a.startContainer.childNodes[a.startOffset]);"element"!=typeOf(b);)b=b.parentNode;return document.id(b)}return document.id(a.item?a.item(0):a.parentElement())},insertContent:function(a){if(Browser.ie){var b=this.getRange();if(b.pasteHTML)b.pasteHTML(a),
b.collapse(!1),b.select();else if(b.insertNode)if(b.deleteContents(),b.createContextualFragment)b.insertNode(b.createContextualFragment(a));else{var c=this.win.document,e=c.createDocumentFragment(),c=c.createElement("div");e.appendChild(c);c.outerHTML=a;b.insertNode(e)}}else this.win.document.execCommand("insertHTML",!1,a)}});var g={};MooEditable.Locale={define:function(a,b){if("null"!=typeOf(window.Locale))return Locale.define("en-US","MooEditable",a,b);"object"==typeOf(a)?Object.merge(g,a):g[a]=
b},get:function(a){return"null"!=typeOf(window.Locale)?Locale.get("MooEditable."+a):a?g[a]:""}};MooEditable.Locale.define({ok:"OK",cancel:"Cancel",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",unorderedList:"Unordered List",orderedList:"Ordered List",indent:"Indent",outdent:"Outdent",undo:"Undo",redo:"Redo",removeHyperlink:"Remove Hyperlink",addHyperlink:"Add Hyperlink",selectTextHyperlink:"Please select the text you wish to hyperlink.",enterURL:"Enter URL",enterImageURL:"Enter image URL",
addImage:"Add Image",toggleView:"Toggle View"});MooEditable.UI={};MooEditable.UI.Toolbar=new Class({Implements:[Events,Options],options:{"class":""},initialize:function(a){this.setOptions(a);this.el=new Element("div",{"class":"mooeditable-ui-toolbar "+this.options["class"]});this.items={};this.content=null},toElement:function(){return this.el},render:function(a){this.content?this.el.adopt(this.content):this.content=a.map(function(a){return"|"==a?this.addSeparator():"/"==a?this.addLineSeparator():
this.addItem(a)}.bind(this));return this},addItem:function(a){var b=MooEditable.Actions[a];if(b){var c=b.options||{},b=new (MooEditable.UI[(b.type||"button").camelCase().capitalize()])(Object.append(c,{name:a,"class":a+"-item toolbar-item",title:b.title,onAction:this.itemAction.bind(this),tabindex:-1}));this.items[a]=b;document.id(b).inject(this.el);return b}},getItem:function(a){return this.items[a]},addSeparator:function(){return(new Element("span.toolbar-separator")).inject(this.el)},addLineSeparator:function(){return(new Element("div.toolbar-line-separator")).inject(this.el)},
itemAction:function(){this.fireEvent("itemAction",arguments)},disable:function(a){Object.each(this.items,function(b){b.name==a?b.activate():b.deactivate().disable()});return this},enable:function(){Object.each(this.items,function(a){a.enable()});return this},show:function(){this.el.setStyle("display","");return this},hide:function(){this.el.setStyle("display","none");return this}});!function(){var a="mac"===Browser.platform?"Cmd":"Ctrl";MooEditable.UI.Button=new Class({Implements:[Events,Options],
options:{title:"",name:"",text:"Button","class":"",shortcut:"",mode:"icon"},initialize:function(a){this.setOptions(a);this.name=this.options.name;this.render()},toElement:function(){return this.el},render:function(){var b=this.options.shortcut?" ( "+a+"+"+this.options.shortcut.toUpperCase()+" )":"",c=this.options.name,e=this.options.title||c;this.el=new Element("button",{"class":"mooeditable-ui-button "+this.options["class"],title:e+b,tabindex:-1,html:'<span class="icon-'+(this.options.icon||c)+' button-icon"></span><span class="button-text">'+
e+"</span>",events:{click:this.click.bind(this),mousedown:function(a){a.preventDefault()}}});"icon"!=this.options.mode&&this.el.addClass("mooeditable-ui-button-"+this.options.mode);this.disabled=this.active=!1;Browser.ie&&this.el.addEvents({mouseenter:function(a){this.addClass("hover")},mouseleave:function(a){this.removeClass("hover")}});return this},click:function(a){a.preventDefault();this.disabled||this.action(a)},action:function(){this.fireEvent("action",[this].concat(Array.from(arguments)))},
enable:function(){this.active&&this.el.removeClass("onActive");if(this.disabled)return this.disabled=!1,this.el.removeClass("disabled").set({disabled:!1,opacity:1}),this},disable:function(){if(!this.disabled)return this.disabled=!0,this.el.addClass("disabled").set({disabled:!0,opacity:.4}),this},activate:function(){if(!this.disabled)return this.active=!0,this.el.addClass("onActive"),this},deactivate:function(){this.active=!1;this.el.removeClass("onActive");return this}})}();MooEditable.UI.Dialog=
new Class({Implements:[Events,Options],options:{"class":"",contentClass:""},initialize:function(a,b){this.setOptions(b);this.html=a;this.el=new Element("div",{"class":"mooeditable-ui-dialog "+this.options["class"],html:'<div class="dialog-content '+this.options.contentClass+'">'+a+"</div>",styles:{display:"none"},events:{click:this.click.bind(this)}})},toElement:function(){return this.el},click:function(){this.fireEvent("click",arguments);return this},open:function(){this.el.setStyle("display","");
this.fireEvent("open",this);return this},close:function(){this.el.setStyle("display","none");this.fireEvent("close",this);return this}});MooEditable.UI.AlertDialog=function(a){if(a)return a=a+' <button class="dialog-ok-button">'+MooEditable.Locale.get("ok")+"</button>",new MooEditable.UI.Dialog(a,{"class":"mooeditable-alert-dialog",onOpen:function(){var a=this.el.getElement(".dialog-ok-button");(function(){a.focus()}).delay(10)},onClick:function(a){a.preventDefault();"button"==a.target.tagName.toLowerCase()&&
document.id(a.target).hasClass("dialog-ok-button")&&this.close()}})};MooEditable.UI.PromptDialog=function(a,b,c){if(a)return a='<label class="dialog-label">'+a+' <input type="text" class="text dialog-input" value="'+b+'"></label> <button class="dialog-button dialog-ok-button">'+MooEditable.Locale.get("ok")+'</button><button class="dialog-button dialog-cancel-button">'+MooEditable.Locale.get("cancel")+"</button>",new MooEditable.UI.Dialog(a,{"class":"mooeditable-prompt-dialog",onOpen:function(){var a=
this.el.getElement(".dialog-input");(function(){a.focus();a.select()}).delay(10)},onClick:function(a){a.preventDefault();if("button"==a.target.tagName.toLowerCase()){var e=document.id(a.target);a=this.el.getElement(".dialog-input");e.hasClass("dialog-cancel-button")?(a.set("value",b),this.close()):e.hasClass("dialog-ok-button")&&(e=a.get("value"),a.set("value",b),this.close(),c&&c.attempt(e,this))}}})};MooEditable.Actions={bold:{title:MooEditable.Locale.get("bold"),options:{shortcut:"b"},states:{tags:["b",
"strong"],css:{"font-weight":"bold"}},events:{beforeToggleView:function(){if(Browser.firefox){var a=this.textarea.get("value"),b=a.replace(/<strong([^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>");a!=b&&this.textarea.set("value",b)}},attach:function(){if(Browser.firefox){var a=this.textarea.get("value"),b=a.replace(/<strong([^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>");a!=b&&(this.textarea.set("value",b),this.setContent(b))}}}},italic:{title:MooEditable.Locale.get("italic"),options:{shortcut:"i"},
states:{tags:["i","em"],css:{"font-style":"italic"}},events:{beforeToggleView:function(){if(Browser.firefox){var a=this.textarea.get("value"),b=a.replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");a!=b&&this.textarea.set("value",b)}},attach:function(){if(Browser.firefox){var a=this.textarea.get("value"),b=a.replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,
"<embed$1>").replace(/<\/em>/gi,"</i>");a!=b&&(this.textarea.set("value",b),this.setContent(b))}}}},underline:{title:MooEditable.Locale.get("underline"),options:{shortcut:"u"},states:{tags:["u"],css:{"text-decoration":"underline"}},events:{beforeToggleView:function(){if(Browser.firefox||Browser.ie){var a=this.textarea.get("value"),b=a.replace(/<span style="text-decoration: underline;"([^>]*)>/gi,"<u$1>").replace(/<\/span>/gi,"</u>");a!=b&&this.textarea.set("value",b)}},attach:function(){if(Browser.firefox||
Browser.ie){var a=this.textarea.get("value"),b=a.replace(/<span style="text-decoration: underline;"([^>]*)>/gi,"<u$1>").replace(/<\/span>/gi,"</u>");a!=b&&(this.textarea.set("value",b),this.setContent(b))}}}},strikethrough:{title:MooEditable.Locale.get("strikethrough"),options:{shortcut:"s"},states:{tags:["s","strike"],css:{"text-decoration":"line-through"}}},insertunorderedlist:{title:MooEditable.Locale.get("unorderedList"),states:{tags:["ul"]},options:{icon:"list-ul"}},insertorderedlist:{title:MooEditable.Locale.get("orderedList"),
states:{tags:["ol"]},options:{icon:"list-ol"}},indent:{title:MooEditable.Locale.get("indent"),states:{tags:["blockquote"]},options:{icon:"indent-right"}},outdent:{title:MooEditable.Locale.get("outdent"),options:{icon:"indent-left"}},undo:{title:MooEditable.Locale.get("undo"),options:{shortcut:"z"}},redo:{title:MooEditable.Locale.get("redo"),options:{shortcut:"y",icon:"repeat"}},unlink:{title:MooEditable.Locale.get("removeHyperlink")},createlink:{title:MooEditable.Locale.get("addHyperlink"),options:{shortcut:"l",
icon:"link"},states:{tags:["a"]},dialogs:{alert:MooEditable.UI.AlertDialog.pass(MooEditable.Locale.get("selectTextHyperlink")),prompt:function(a){return MooEditable.UI.PromptDialog(MooEditable.Locale.get("enterURL"),"http://",function(b){a.execute("createlink",!1,b.trim())})}},command:function(){var a=this.selection,b=this.dialogs.createlink;if(a.isCollapsed()){var c=a.getNode();"a"==c.get("tag")&&c.get("href")?(a.selectNode(c),b=b.prompt,b.el.getElement(".dialog-input").set("value",c.get("href")),
b.open()):b.alert.open()}else c=a.getText(),b=b.prompt,e.test(c)&&b.el.getElement(".dialog-input").set("value",c),b.open()}},urlimage:{title:MooEditable.Locale.get("addImage"),options:{shortcut:"m",icon:"picture"},dialogs:{prompt:function(a){return MooEditable.UI.PromptDialog(MooEditable.Locale.get("enterImageURL"),"http://",function(b){a.execute("insertimage",!1,b.trim())})}},command:function(){this.dialogs.urlimage.prompt.open()}},toggleview:{title:MooEditable.Locale.get("toggleView"),command:function(){"textarea"==
this.mode?this.toolbar.enable():this.toolbar.disable("toggleview");this.toggleView()},options:{icon:"code"}}};MooEditable.Actions.Settings={};Element.Properties.mooeditable={get:function(){return this.retrieve("MooEditable")}};Element.implement({mooEditable:function(a){var b=this.get("mooeditable");b||(b=new MooEditable(this,a));return b}});var k=null,n=null,p=null;window.addEvent("mousedown:relay(.mooeditable-resizer)",function(a,d){a.preventDefault();k=d.getPrevious();"none"==k.getStyle("display")&&
(k=k.getPrevious());n=k.getSize().y;p=a.client.y;"IFRAME"==k.tagName&&k.setStyle("visibility","hidden");window.addEvents({mousemove:c,mouseup:b})})})();
MooEditable.UI.MenuList=new Class({Implements:[Events,Options],options:{title:"",name:"","class":"",list:[]},initialize:function(c){this.setOptions(c);this.name=this.options.name;this.render()},toElement:function(){return this.el},render:function(){var c="";this.options.list.each(function(b){c+='<option value="{value}" style="{style}">{text}</option>'.substitute(b)});this.el=new Element("select",{"class":this.options["class"],title:this.options.title,tabindex:-1,html:c,styles:{height:"21px"},events:{change:this.change.bind(this)}});
this.disabled=!1;Browser.ie&&this.el.addEvents({mouseenter:function(b){this.addClass("hover")},mouseleave:function(b){this.removeClass("hover")}});return this},change:function(c){c.preventDefault();this.disabled||this.action(c.target.value)},action:function(){this.fireEvent("action",[this].concat(Array.from(arguments)))},enable:function(){if(this.disabled)return this.disabled=!1,this.el.set("disabled",!1).removeClass("disabled").set({disabled:!1,opacity:1}),this},disable:function(){if(!this.disabled)return this.disabled=
!0,this.el.set("disabled",!0).addClass("disabled").set({disabled:!0,opacity:.4}),this},activate:function(c){if(!this.disabled){var b=0;c&&this.options.list.each(function(h,e){h.value==c&&(b=e)});this.el.selectedIndex=b;return this}},deactivate:function(){this.el.selectedIndex=0;this.el.removeClass("onActive");return this}});
MooEditable.Locale.define({blockFormatting:"Format de block",paragraph:"Paragraphe",heading1:"En-t\u00eate 1",heading2:"En-t\u00eate 2",heading3:"En-t\u00eate 3",heading4:"En-t\u00eate 4",alignLeft:"Align Left",alignRight:"Align Right",alignCenter:"Align Center",alignJustify:"Align Justify",removeFormatting:"Remove Formatting",insertHorizontalRule:"Insert Horizontal Rule"});
Object.append(MooEditable.Actions,{formatBlock:{title:MooEditable.Locale.get("blockFormatting"),type:"menu-list",options:{list:[{text:MooEditable.Locale.get("paragraph"),value:"p"},{text:MooEditable.Locale.get("heading2"),value:"h2",style:"font-size:18px; font-weight:bold;"},{text:MooEditable.Locale.get("heading3"),value:"h3",style:"font-size:14px; font-weight:bold;"},{text:MooEditable.Locale.get("heading4"),value:"h4",style:"font-size:12px; font-weight:bold;"}]},states:{tags:["p","h2","h3","h4"]},
command:function(c,b){var h="<"+b+">";this.focus();this.execute("formatBlock",!1,h)}},justifyleft:{title:MooEditable.Locale.get("alignLeft"),states:{css:{"text-align":"left"}},command:function(c,b){var h=this.selection.getNode(),e=h.tagName;"IMG"==e||"OBJECT"==e?h.align="left":"P"==e&&(h.align="")},options:{icon:"align-left"}},justifyright:{title:MooEditable.Locale.get("alignRight"),states:{css:{"text-align":"right"}},command:function(c,b){var h=this.selection.getNode(),e=h.tagName;"IMG"==e||"OBJECT"==
e?h.align="right":"P"==e&&(h.align="right")},options:{icon:"align-right"}},justifycenter:{title:MooEditable.Locale.get("alignCenter"),states:{tags:["center"],css:{"text-align":"center"}},options:{icon:"align-center"}},justifyfull:{title:MooEditable.Locale.get("alignJustify"),states:{css:{"text-align":"justify"}},options:{icon:"align-justify"}},removeformat:{title:MooEditable.Locale.get("removeFormatting"),options:{icon:"eraser"}},insertHorizontalRule:{title:MooEditable.Locale.get("insertHorizontalRule"),
states:{tags:["hr"]},command:function(){this.selection.insertContent("<hr>")}}});
MooEditable.UI.PasteDialog=new Class({Extends:MooEditable.UI.Dialog,initialize:function(c){this.editor=c;this.unique=Math.random();this.dummy_el=new Element("div",{styles:{display:"none"}})},toElement:function(){return this.dummy_el},close:function(){this.adjust&&(this.adjust.destroy(),this.adjust=null);this.fireEvent("close",this);return this},open:function(){if(this.adjust)return this.close();var c=this.editor,b=c.toolbar.items.paste.el.getCoordinates();this.adjust=adjust=new Element("div",{"class":"mooeditable-ui-dialog mooeditable-paste-dialog",
styles:{position:"absolute",width:"64ex",left:b.left+b.width/2,"margin-left":"-32ex",top:b.bottom+20}});var h,e=new Element("div",{"class":"mooeditable-ui-dialog-action-frame"});e.adopt(b=new Element("button.btn-primary",{type:"button",html:"Coller"}));var f=new Element("div",{"class":"mooeditable-ui-dialog-contents-frame"});f.adopt(h=new Element("textarea",{rows:10}));adjust.adopt(f,e);b.addEvent("click",function(b){if(b=h.get("value"))b=b.replace(/\r?\n\r?\n/gi,"</p><p>"),b=b.replace(/\r?\n/gi,
"<br />"),c.selection.insertContent("<p>"+b+"</p>");this.close()}.bind(this));document.body.appendChild(adjust);h.focus()}});MooEditable.Actions.paste={title:"Paste text, stripping formating",dialogs:{prompt:function(c){return new MooEditable.UI.PasteDialog(c)}},command:function(){this.dialogs.paste.prompt.open()}};
!function(){function c(b,c){b=b.replace(/<(\w+)([^>]*)>\s+/g,"<$1$2>\n");b=b.replace(/>\s+</g,">\n<");c?this.options.paragraphise?(b=("<p>"+b+"</p>").replace(/\n\n/g,"</p><p>"),b=b.replace(/<p>\s<\/p>/gi,"")):b=b.replace(/\n/g,"<br />"):(b=b.replace(/<html[^>]*?>(.*)/gim,"$1"),b=b.replace(/<\/html>/gi,""),b=b.replace(/<body[^>]*?>(.*)/gi,"$1"),b=b.replace(/<\/body>/gi,""),b=b.replace(/<style[^>]*?>[\s\S]*?<\/style[^>]*>/gi,""),b=b.replace(/<(?:meta|link)[^>]*>\s*/gi,""),b=b.replace(/<\\?\?xml[^>]*>/gi,
""),b=b.replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,""),b=b.replace(/<o:p>\s*<\/o:p>/g,""),b=b.replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;"),b=b.replace(/<\/?\w+:[^>]*>/gi,""),b=b.replace(/<\!--[\s\S]*?--\x3e/g,""),b=b.replace(/<\!\[[\s\S]*?\]>/g,""),b=b.replace(/\s*mso-[^:]+:[^;"']+;?/gi,""),b=b.replace(/<(\w[^>]*) style='([^\']*)'([^>]*)/gim,"<$1$3"),b=b.replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gim,"<$1$3"),b=b.replace(/\s*margin: 0cm 0cm 0pt\s*;/gi,""),b=b.replace(/\s*margin: 0cm 0cm 0pt\s*"/gi,'"'),
b=b.replace(/\s*text-indent: 0cm\s*;/gi,""),b=b.replace(/\s*text-indent: 0cm\s*"/gi,'"'),b=b.replace(/\s*text-align: [^\s;]+;?"/gi,'"'),b=b.replace(/\s*page-break-before: [^\s;]+;?"/gi,'"'),b=b.replace(/\s*font-variant: [^\s;]+;?"/gi,'"'),b=b.replace(/\s*tab-stops:[^;"']*;?/gi,""),b=b.replace(/\s*tab-stops:[^"']*/gi,""),b=b.replace(/\s*face="[^"']*"/gi,""),b=b.replace(/\s*face=[^ >]*/gi,""),b=b.replace(/\s*font-family:[^;"']*;?/gi,""),b=b.replace(/\s*font-size:[^;"']*;?/gi,""),b=b.replace(/\<[\w[^>]*\sclass="([^"]+)"/,
function(b,c){return b.replace(c,c.replace(/Mso[^\s]+/gi,"").trim())}),b=b.replace(/<(\w+)[^>]*\sstyle="[^"']*display\s?:\s?none[\s \S]*?<\/\1>/ig,""),b=b.replace(/\s*style='\s*'/gi,""),b=b.replace(/\s*style="\s*"/gi,""),b=b.replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/gi,"&nbsp;"),b=b.replace(/<span\s*[^>]*><\/span>/gi,""),b=b.replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3"),b=b.replace(/<(font|i|span|strike|u)(\s*>|\s+[^>]+>)/gi,""),b=b.replace(/<\/(font|i|span|strike|u)>/gi,""),b=b.replace(/<h\d>\s*<\/h\d>/gi,
""),b=b.replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3"),b=b.replace(/<(\w[^>]*) onmouseover="([^\"']*)"([^>]*)/gi,"<$1$3"),b=b.replace(/<(\w[^>]*) onmouseout="([^\"']*)"([^>]*)/gi,"<$1$3"),b=b.replace(/<(h\d)><em>([\s\S]*?)<\/em><\/\1>/gi,"<$1>$2</$1>"),b=b.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>"),b=b.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>"),b=b.replace(/<\s+[^>]*>/gi,""),b=b.replace(/<(td|th)([^>]*)>\s*<\/(td|th)>/gi,"<$1$2>&nbsp;</$1>"),b=b.replace(/<br>/gi,
"<br />"),b=b.replace(/^(\s*<br \/>\s*)+|(\s*<br \/>\s*)+$/gi,""),b=b.replace(/(\s*<br \/>\s*)+<\/p>/gim,"</p>"),b=b.replace(/<((?!th|td)\w+)[^>]*>\s*&nbsp;\s*<\/\1>/gi,""),b=b.replace(/<p>\s<\/p>/gi,""),b=b.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,function(b,c){return c.match(/^iframe$/i)?b:""}),b=b.trim());return b=this.manageSrcAttribute(b)}try{module.exports.cleanHtml=c;return}catch(b){}MooEditable=Class.refactor(MooEditable,{attach:function(){var b=this.previous();this.doc.body.addListener("paste",
this.cleanPaste.bind(this));return b},cleanPaste:function(b){var c=b.clipboardData&&b.clipboardData.getData?b.clipboardData.getData("text/html"):window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):!1;c&&""!==c.trim()||!b.clipboardData||!b.clipboardData.getData||(c=b.clipboardData.getData("Text"));c?(window.clipboardData?this.selection.insertContent(this.cleanHtml(c,1)):this.selection.insertContent(this.cleanHtml(c)),b.preventDefault(),b.stopPropagation()):(this.selection.insertContent('<span id="INSERTION_MARKER">&nbsp;</span>'),
this.txtMarked=this.doc.body.get("html"),this.doc.body.set("html",""),this.replaceMarkerWithPastedText.delay(5,this));return this},replaceMarkerWithPastedText:function(){var b=this.cleanHtml(this.doc.body.get("html"));this.doc.body.set("html",this.txtMarked);this.selection.selectNode(this.doc.body.getElementById("INSERTION_MARKER"));this.selection.insertContent(b);return this},cleanHtml:function(b,h){return c.call(this,b,h)}})}();
MooEditable.Actions.outline={title:"Outline blocks",command:function(){this.doc.body.toggleClass("mooeditable-outline")},options:{icon:"info"}};
MooEditable.UI.ImageDialog=function(){return new Class({Extends:MooEditable.UI.Dialog,initialize:function(c){this.editor=c;this.unique=Math.random();this.dummy_el=new Element("div",{styles:{display:"none"}})},toElement:function(){return this.dummy_el},click:function(){this.fireEvent("click",arguments);return this},close:function(){this.popover&&this.popover.hide();this.fireEvent("close",this);return this},open:function(){this.node=this.editor.selection.getNode();this.node&&"img"==this.node.get("tag")||
(this.node=this.editor.doc.createElement("img"),this.node.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////IiIiHNlGNAAAAAF0Uk5TAEDm2GYAAAAeSURBVHjaYmBkYMCPKJVnZBi1YtSKUSuGphUAAQYAxEkBVsmDp6QAAAAASUVORK5CYII=",this.editor.selection.getRange().insertNode(this.node));this.node.addEvent("load",function(c){this.popover&&this.popover.reposition()}.bind(this));this.previousImage=this.getValidSrc();this.popover?(this.popover.attachAnchor(this.node),
this.popover.adjust.setValue(this.getValidNode()),this.popover.show()):(this.fetchAdjustOperation||(this.fetchAdjustOperation=new Request.Widget("adjust-thumbnail/popup",this.setupPopover.bind(this))),this.fetchAdjustOperation.get({selected:this.getValidSrc()}))},getValidNode:function(){var c=this.node;return c&&c.src&&!c.src.test(/^data:/)?c:null},getValidSrc:function(){var c=this.getValidNode();return c?c.get("src"):null},setupPopover:function(c){var b=this;c=this.popover=new (require("icybee/adjust-popover"))(c,
{anchor:this.node,iframe:this.editor.iframe});var h=c.adjust;c.observe(Brickrouge.Popover.EVENT_ACTION,function(c){c=c.action;var f=b.getValidSrc();"cancel"==c?(f=b.previousImage,b.node.src=f||""):"remove"==c&&(f=null);if(!f||f.match(/^data:/))b.node.destroy(),delete b.node;b.close()});h.setValue(this.getValidNode());h.addEvent("change",function(c){var f=c.options,g=b.node;g.src=b.editor.baseHREF+c.url;g.set("data-nid",c.nid);f.lightbox?g.set("data-lightbox",!0):g.removeAttribute("data-lightbox");
f.width&&"surface"!=f.method&&"constrained"!=f.method?g.set("width",f.width):g.removeAttribute("width");f.height&&"surface"!=f.method&&"constrained"!=f.method?g.set("height",f.height):g.removeAttribute("height")});c.show()}})}();MooEditable.Actions.image={title:"Add/Edit Image",options:{shortcut:"m",icon:"picture"},dialogs:{prompt:function(c){return new MooEditable.UI.ImageDialog(c)}},command:function(){this.dialogs.image.prompt.open()}};
!function(c){var b=[];c.observe(c.EVENT_UPDATE,function(h){h.fragment.querySelectorAll("textarea.moo").forEach(function(e){var f=c.uidOf(e);if(!(f in b)){var g=c.Dataset.from(e);g.externalCss&&(g.externalCSS=JSON.decode(g.externalCss));g.baseUrl&&(g.baseURL=g.baseUrl);b[f]=e.mooEditable(g)}})})}(Brickrouge);
