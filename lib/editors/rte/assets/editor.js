!function(){function t(t){var e,i=Math.max(r+t.client.y-l,100);e="IFRAME"==a.tagName?a.getNext():a.getPrevious(),a.setStyle("height",i),e.setStyle("height",i)}function e(i){window.removeEvent("mousemove",t),window.removeEvent("mouseup",e),"IFRAME"==a.tagName&&a.setStyle("visibility",""),a=null}var i=/^(H[1-6]|HR|P|DIV|ADDRESS|PRE|FORM|TABLE|LI|OL|UL|TD|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD|SCRIPT|NOSCRIPT|STYLE|ARTICLE|ASIDE|DETAILS|FIGCAPTION|FIGURE|FOOTER|HEADER|HGROUP|NAV|SECTION)$/i,o=/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i,s=/<(script|noscript|style)[\u0000-\uFFFF]*?<\/(script|noscript|style)>/g;this.MooEditable=new Class({Implements:[Events,Options],options:{toolbar:!0,cleanup:!0,paragraphise:!0,xhtml:!0,semantics:!0,actions:"bold italic underline strikethrough | insertunorderedlist insertorderedlist indent outdent | undo redo | createlink unlink | urlimage | toggleview",handleSubmit:!0,handleLabel:!0,disabled:!1,baseCSS:"html{ height: 100%; cursor: text; } body{ font-family: sans-serif; }",extraCSS:"",externalCSS:"",html:'<!DOCTYPE html><html id="{HTMLID}" lang="{LANGUAGE}"><head><meta charset="UTF-8">{BASEHREF}<style>{BASECSS} {EXTRACSS}</style>{EXTERNALCSS}</head><body class="editor-rte"></body></html>',rootElement:"p",baseURL:"",dimensions:null,htmlId:"wysiwyg"},initialize:function(t,e){("contentEditable"in document.body||"designMode"in document)&&(this.setOptions(e),this.textarea=document.id(t),this.textarea.store("MooEditable",this),this.textarea.addEvent("change",function(t){this.setContent(this.textarea.get("value"))}.bind(this)),this.actions=this.options.actions.clean().split(" "),this.keys={},this.dialogs={},this.protectedElements=[],this.actions.each(function(t){var e=MooEditable.Actions[t];if(e){if(e.options){var i=e.options.shortcut;i&&(this.keys[i]=t)}e.dialogs&&Object.each(e.dialogs,function(e,i){e=e.attempt(this),e.name=t+":"+i,"object"!=typeOf(this.dialogs[t])&&(this.dialogs[t]={}),this.dialogs[t][i]=e},this),e.events&&Object.each(e.events,function(t,e){this.addEvent(e,t)},this)}}.bind(this)),this.render())},toElement:function(){return this.textarea},render:function(){var t=this,e=this.options.dimensions||this.textarea.getSize();this.container=new Element("div",{id:this.textarea.id?this.textarea.id+"-mooeditable-container":null,"class":"mooeditable-container"}),this.textarea.addClass("mooeditable-textarea").setStyle("height",e.y),this.iframe=new IFrame({"class":"mooeditable-iframe",frameBorder:0,src:'javascript:""',styles:{height:Math.max(100,e.y)}}),this.resizer=new Element("div.mooeditable-resizer"),this.toolbar=new MooEditable.UI.Toolbar({onItemAction:function(){var e=Array.from(arguments),i=e[0];t.action(i.name,e)}}),this.attach.delay(1,this),this.options.handleLabel&&this.textarea.id&&$$('label[for="'+this.textarea.id+'"]').addEvent("click",function(e){"iframe"==t.mode&&(e.preventDefault(),t.focus())}),this.options.handleSubmit&&(this.form=this.textarea.getParent("form"),this.form&&this.form.addEvent("submit",function(){"iframe"==t.mode&&t.saveContent()})),this.fireEvent("render",this)},attach:function(){var t=this;this.mode="iframe",this.editorDisabled=!1,this.container.wraps(this.textarea),this.textarea.setStyle("display","none"),this.iframe.setStyle("display","").inject(this.textarea,"before"),this.resizer.inject(this.textarea,"after"),Object.each(this.dialogs,function(e,i){Object.each(e,function(e){document.id(e).inject(t.iframe,"before");var o;e.addEvents({open:function(){o=t.selection.getRange(),t.editorDisabled=!0,t.toolbar.disable(i),t.fireEvent("dialogOpen",this)},close:function(){t.toolbar.enable(),t.editorDisabled=!1,t.focus(),o&&t.selection.setRange(o),t.fireEvent("dialogClose",this)}})})}),this.win=this.iframe.contentWindow,this.doc=this.win.document,Browser.firefox&&(this.doc.designMode="On");var e="";this.options.externalCSS&&("array"==typeOf(this.options.externalCSS)?this.options.externalCSS.each(function(t){e+='<link rel="stylesheet" href="'+t+'">\n'}):e='<link rel="stylesheet" href="'+this.options.externalCSS+'">'),this.baseHREF=document.location.protocol+"//"+document.location.hostname,document.location.port&&(this.baseHREF+=":"+document.location.port);var i=this.options.html.substitute({BASECSS:this.options.baseCSS,EXTRACSS:this.options.extraCSS,EXTERNALCSS:e,BASEHREF:'<base href="'+this.baseHREF+'" />',HTMLID:this.options.htmlId,LANGUAGE:this.textarea.get("lang")||document.html.get("lang")});if(this.doc.open(),this.doc.write(i),this.doc.close(),Browser.ie?this.doc.body.contentEditable=!0:this.doc.designMode="On",Object.append(this.win,new Window),Object.append(this.doc,new Document),Browser.Element){var o=this.win.Element.prototype;for(var s in Element)s.test(/^[A-Z]|\$|prototype|mooEditable/)||(o[s]=Element.prototype[s])}else document.id(this.doc.body);if(this.setContent(this.textarea.get("value")),this.doc.addEvents({mouseup:this.editorMouseUp.bind(this),mousedown:this.editorMouseDown.bind(this),mouseover:this.editorMouseOver.bind(this),mouseout:this.editorMouseOut.bind(this),mouseenter:this.editorMouseEnter.bind(this),mouseleave:this.editorMouseLeave.bind(this),contextmenu:this.editorContextMenu.bind(this),click:this.editorClick.bind(this),dblclick:this.editorDoubleClick.bind(this),keypress:this.editorKeyPress.bind(this),keyup:this.editorKeyUp.bind(this),keydown:this.editorKeyDown.bind(this),focus:this.editorFocus.bind(this),blur:this.editorBlur.bind(this)}),this.win.addEvents({focus:this.editorFocus.bind(this),blur:this.editorBlur.bind(this),load:function(){this.actions.each(function(t){var e=MooEditable.Actions[t];e&&e.load&&e.load(this)},this)}.bind(this)}),["cut","copy","paste"].each(function(e){t.doc.body.addListener(e,t["editor"+e.capitalize()].bind(t))}),this.textarea.addEvent("keypress",this.textarea.retrieve("mooeditable:textareaKeyListener",this.keyListener.bind(this))),Browser.firefox2&&this.doc.addEvent("focus",function(){t.win.fireEvent("focus").focus()}),this.doc.addEventListener&&this.doc.addEventListener("focus",function(){t.win.fireEvent("focus")},!0),!Browser.ie&&!Browser.opera){var n=function(){t.execute("styleWithCSS",!1,!1),t.doc.removeEvent("focus",n)};this.win.addEvent("focus",n)}return this.options.toolbar&&(document.id(this.toolbar).inject(this.container,"top"),this.toolbar.render(this.actions)),this.options.disabled&&this.disable(),this.selection=new MooEditable.Selection(this.win),this.oldContent=this.getContent(),this.fireEvent("attach",this),this},detach:function(){return this.saveContent(),this.textarea.setStyle("display","").removeClass("mooeditable-textarea").inject(this.container,"before"),this.textarea.removeEvent("keypress",this.textarea.retrieve("mooeditable:textareaKeyListener")),this.container.dispose(),this.fireEvent("detach",this),this},enable:function(){return this.editorDisabled=!1,this.toolbar.enable(),this},disable:function(){return this.editorDisabled=!0,this.toolbar.disable(),this},editorFocus:function(t){this.oldContent="",this.fireEvent("editorFocus",[t,this])},editorBlur:function(t){this.oldContent=this.saveContent().getContent(),this.fireEvent("editorBlur",[t,this])},editorMouseUp:function(t){return this.editorDisabled?void t.stop():(this.options.toolbar&&this.checkStates(),void this.fireEvent("editorMouseUp",[t,this]))},editorMouseDown:function(t){return this.editorDisabled?void t.stop():void this.fireEvent("editorMouseDown",[t,this])},editorMouseOver:function(t){return this.editorDisabled?void t.stop():void this.fireEvent("editorMouseOver",[t,this])},editorMouseOut:function(t){return this.editorDisabled?void t.stop():void this.fireEvent("editorMouseOut",[t,this])},editorMouseEnter:function(t){return this.editorDisabled?void t.stop():void this.fireEvent("editorMouseEnter",[t,this])},editorMouseLeave:function(t){return this.editorDisabled?void t.stop():void this.fireEvent("editorMouseLeave",[t,this])},editorContextMenu:function(t){return this.editorDisabled?void t.stop():void this.fireEvent("editorContextMenu",[t,this])},editorClick:function(t){if(Browser.safari||Browser.chrome){var e=t.target;"img"==Element.get(e,"tag")&&(this.options.baseURL&&(console.log("src: %s (%s)",e.getProperty("src"),e.getProperty("src").match("/https?:///")),e.getProperty("src").match("/https?:///")||e.setProperty("src",this.options.baseURL+e.getProperty("src"))),this.selection.selectNode(e),this.checkStates())}this.fireEvent("editorClick",[t,this])},editorDoubleClick:function(t){this.fireEvent("editorDoubleClick",[t,this])},editorKeyPress:function(t){return this.editorDisabled?void t.stop():(this.keyListener(t),void this.fireEvent("editorKeyPress",[t,this]))},editorKeyUp:function(t){if(this.editorDisabled)return void t.stop();var e=t.code;this.options.toolbar&&(/^enter|left|up|right|down|delete|backspace$/i.test(t.key)||e>=33&&36>=e||45==e||t.meta||t.control)&&(Browser.ie6?(clearTimeout(this.checkStatesDelay),this.checkStatesDelay=this.checkStates.delay(500,this)):this.checkStates()),this.fireEvent("editorKeyUp",[t,this])},editorKeyDown:function(t){if(this.editorDisabled)return void t.stop();if("enter"==t.key)if(this.options.paragraphise){if(t.shift&&(Browser.safari||Browser.chrome)){var e=this.selection,o=e.getRange(),s=this.doc.createElement("br");if(o.insertNode(s),o.setStartAfter(s),o.setEndAfter(s),e.setRange(o),e.getSelection().focusNode==s.previousSibling){var n=this.doc.createTextNode("Â "),a=s.parentNode,r=s.nextSibling;r?a.insertBefore(n,r):a.appendChild(n),e.selectNode(n),e.collapse(1)}this.win.scrollTo(0,Element.getOffsets(e.getRange().startContainer).y),t.preventDefault()}else if(Browser.firefox||Browser.safari||Browser.chrome){var l=this.selection.getNode(),c=Element.getParents(l).include(l).some(function(t){return t.nodeName.test(i)});c||this.execute("insertparagraph")}}else if(Browser.ie){var o=this.selection.getRange(),l=this.selection.getNode();o&&"li"!=l.get("tag")&&(this.selection.insertContent("<br>"),this.selection.collapse(!1)),t.preventDefault()}if(Browser.opera){var d=t.control||t.meta;d&&"x"==t.key?this.fireEvent("editorCut",[t,this]):d&&"c"==t.key?this.fireEvent("editorCopy",[t,this]):(d&&"v"==t.key||t.shift&&45==t.code)&&this.fireEvent("editorPaste",[t,this])}this.fireEvent("editorKeyDown",[t,this])},editorCut:function(t){return this.editorDisabled?void t.stop():void this.fireEvent("editorCut",[t,this])},editorCopy:function(t){return this.editorDisabled?void t.stop():void this.fireEvent("editorCopy",[t,this])},editorPaste:function(t){return this.editorDisabled?void t.stop():void this.fireEvent("editorPaste",[t,this])},keyListener:function(t){var e="mac"===Browser.platform?t.meta:t.control;if(e&&this.keys[t.key]){t.preventDefault();var i=this.toolbar.getItem(this.keys[t.key]);i.action(t)}},focus:function(){return("iframe"==this.mode?this.win:this.textarea).focus(),this.fireEvent("focus",this),this},action:function(t,e){var i=MooEditable.Actions[t];i.command&&"function"==typeOf(i.command)?i.command.apply(this,e):(this.focus(),this.execute(t,!1,e),"iframe"==this.mode&&this.checkStates())},execute:function(t,e,i){return this.busy?void 0:(this.busy=!0,this.doc.execCommand(t,e,i),this.saveContent(),this.busy=!1,!1)},toggleView:function(){return this.fireEvent("beforeToggleView",this),"textarea"==this.mode?(this.mode="iframe",this.iframe.setStyle("display",""),this.setContent(this.textarea.value),this.textarea.setStyle("display","none")):(this.saveContent(),this.mode="textarea",this.textarea.setStyle("display",""),this.textarea.setStyle("visibility","visible"),this.iframe.setStyle("display","none")),this.fireEvent("toggleView",this),this.focus.delay(10,this),this},getContent:function(){var t=this.protectedElements,e=this.doc.body.get("html").replace(/<!-- mooeditable:protect:([0-9]+) -->/g,function(e,i){return t[i.toInt()]});return this.cleanup(this.ensureRootElement(e))},setContent:function(t){var e=this.protectedElements;return t=t.replace(s,function(t){return e.push(t),"<!-- mooeditable:protect:"+(e.length-1)+" -->"}),t=this.manageSrcAttribute(t),this.doc.body.set("html",this.ensureRootElement(t)),this},saveContent:function(){var t;return t="iframe"==this.mode?this.getContent():this.textearea.innerHTML,t=t.replace(new RegExp('="'+this.baseHREF,"gi"),'="'),this.textarea.set("value",t),this},manageSrcAttribute:function(t){var e=this.href;return t.replace(/src="([^"]+)/gi,function(t,i){return i.match(/^(https?:\/\/|\/)/)||(i=e+i),'src="'+i})},ensureRootElement:function(t){if(this.options.rootElement){for(var e=new Element("div",{html:t.trim()}),o=-1,s=!1,n="",a=e.childNodes.length,r=0;a>r;r++){var l=e.childNodes[r],c=l.nodeName;if(c.test(i)||"#comment"===c?s=!0:"#text"===c?l.nodeValue.trim()&&(0>o&&(o=r),n+=l.nodeValue):(0>o&&(o=r),n+=new Element("div").adopt($(l).clone()).get("html")),r==a-1&&(s=!0),o>=0&&s){var d=new Element(this.options.rootElement,{html:n});e.replaceChild(d,e.childNodes[o]);for(var h=o+1;r>h;h++)e.removeChild(e.childNodes[h]),a--,r--,h--;o=-1,s=!1,n=""}}t=e.get("html").replace(/\n\n/g,"")}return t},checkStates:function(){var t=this.selection.getNode();t&&"element"==typeOf(t)&&this.actions.each(function(e){var o=this.toolbar.getItem(e);if(o){o.deactivate();var s=MooEditable.Actions[e].states;if(s){if("function"==typeOf(s))return void s.attempt([document.id(t),o],this);try{if(this.doc.queryCommandState(e))return void o.activate()}catch(n){}if(s.tags){var a=t;do{var r=a.tagName.toLowerCase();if(s.tags.contains(r)){o.activate(r);break}}while(null!=(a=Element.getParent(a)))}if(s.css){var a=t;do{var l=!1;for(var c in s.css){var d=s.css[c];a.style[c.camelCase()].contains(d)&&(o.activate(d),l=!0)}if(l||a.tagName.test(i))break}while(null!=(a=Element.getParent(a)))}}}}.bind(this))},cleanup:function(t){if(!this.options.cleanup)return t.trim();do{var e=t;this.options.baseURL&&(t=t.replace('="'+this.options.baseURL,'="/')),t=t.replace(/<br class\="webkit-block-placeholder">/gi,"<br />"),t=t.replace(/<span class="Apple-style-span">(.*)<\/span>/gi,"$1"),t=t.replace(/ class="Apple-style-span"/gi,""),t=t.replace(/<span style="">/gi,""),t=t.replace(/<p>\s*<br ?\/?>\s*<\/p>/gi,"<p>Â </p>"),t=t.replace(/<p>(&nbsp;|\s)*<\/p>/gi,"<p>Â </p>"),this.options.semantics||(t=t.replace(/\s*<br ?\/?>\s*<\/p>/gi,"</p>")),this.options.xhtml&&(t=t.replace(/<br>/gi,"<br />")),this.options.semantics&&(Browser.ie&&(t=t.replace(/<li>\s*<div>(.+?)<\/div><\/li>/g,"<li>$1</li>")),(Browser.safari||Browser.chrome)&&(t=t.replace(/^([\w\s]+.*?)<div>/i,"<p>$1</p><div>"),t=t.replace(/<div>(.+?)<\/div>/gi,"<p>$1</p>")),Browser.ie||(t=t.replace(/<p>[\s\n]*(<(?:ul|ol)>.*?<\/(?:ul|ol)>)(.*?)<\/p>/gi,"$1<p>$2</p>"),t=t.replace(/<\/(ol|ul)>\s*(?!<(?:p|ol|ul|img).*?>)((?:<[^>]*>)?\w.*)$/g,"</$1><p>$2</p>")),t=t.replace(/<br[^>]*><\/p>/g,"</p>"),t=t.replace(/<p([^>]*)>(.*?)<\/p>(?!\n)/g,"<p$1>$2</p>\n"),t=t.replace(/<\/(ul|ol|p)>(?!\n)/g,"</$1>\n"),t=t.replace(/><li>/g,">\n	<li>"),t=t.replace(/([^\n])<\/(ol|ul)>/g,"$1\n</$2>"),t=t.replace(/([^\n])<img/gi,"$1\n<img"),t=t.replace(/^\s*$/g,"")),t=t.replace(/<br ?\/?>$/gi,""),t=t.replace(/^<br ?\/?>/gi,""),this.options.paragraphise&&(t=t.replace(/(h[1-6]|p|div|address|pre|li|ol|ul|blockquote|center|dl|dt|dd)><br ?\/?>/gi,"$1>")),t=t.replace(/<br ?\/?>\s*<\/(h1|h2|h3|h4|h5|h6|li|p)/gi,"</$1"),t=t.replace(/<span style="font-weight: bold;">(.*)<\/span>/gi,"<strong>$1</strong>"),t=t.replace(/<span style="font-style: italic;">(.*)<\/span>/gi,"<em>$1</em>"),t=t.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>"),t=t.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>"),t=t.replace(/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration: underline;">$1</span>'),t=t.replace(/<strong><span style="font-weight: normal;">(.*)<\/span><\/strong>/gi,"$1"),t=t.replace(/<em><span style="font-weight: normal;">(.*)<\/span><\/em>/gi,"$1"),t=t.replace(/<span style="text-decoration: underline;"><span style="font-weight: normal;">(.*)<\/span><\/span>/gi,"$1"),t=t.replace(/<strong style="font-weight: normal;">(.*)<\/strong>/gi,"$1"),t=t.replace(/<em style="font-weight: normal;">(.*)<\/em>/gi,"$1"),t=t.replace(/<[^> ]*/g,function(t){return t.toLowerCase()}),t=t.replace(/<[^>]*>/g,function(t){return t=t.replace(/ [^=]+=/g,function(t){return t.toLowerCase()})}),t=t.replace(/<[^!][^>]*>/g,function(t){return t=t.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"')}),this.options.xhtml&&(t=t.replace(/<img([^>]+)(\s*[^\/])>(<\/img>)*/gi,"<img$1$2 />")),t=t.replace(/<p>(?:\s*)<p>/g,"<p>"),t=t.replace(/<\/p>\s*<\/p>/g,"</p>"),t=t.replace(/<pre[^>]*>.*?<\/pre>/gi,function(t){return t.replace(/<br ?\/?>/gi,"\n")}),t=t.trim()}while(t!=e);return t=this.cleanHtml(t)}}),MooEditable.Selection=new Class({initialize:function(t){this.win=t},getSelection:function(){return this.win.focus(),this.win.getSelection?this.win.getSelection():this.win.document.selection},getRange:function(){var t=this.getSelection();if(!t)return null;try{return t.rangeCount>0?t.getRangeAt(0):t.createRange?t.createRange():null}catch(e){return this.doc.body.createTextRange()}},setRange:function(t){if(t.select)Function.attempt(function(){t.select()});else{var e=this.getSelection();e.addRange&&(e.removeAllRanges(),e.addRange(t))}},selectNode:function(t,e){var i=this.getRange(),o=this.getSelection();return i.moveToElementText?Function.attempt(function(){i.moveToElementText(t),i.select()}):o.addRange?(e?i.selectNodeContents(t):i.selectNode(t),o.removeAllRanges(),o.addRange(i)):o.setBaseAndExtent(t,0,t,1),t},isCollapsed:function(){var t=this.getRange();return t.item?!1:0==t.boundingWidth||this.getSelection().isCollapsed},collapse:function(t){var e=this.getRange(),i=this.getSelection();e.select?(e.collapse(t),e.select()):t?i.collapseToStart():i.collapseToEnd()},getContent:function(){var t=this.getRange(),e=new Element("body");if(this.isCollapsed())return"";t.cloneContents?e.appendChild(t.cloneContents()):void 0!=t.item||void 0!=t.htmlText?e.set("html",t.item?t.item(0).outerHTML:t.htmlText):e.set("html",t.toString());var i=e.get("html");return i},getText:function(){var t=this.getRange(),e=this.getSelection();return this.isCollapsed()?"":t.text||(e.toString?e.toString():"")},getNode:function(){var t=this.getRange();if(!Browser.ie||Browser.version>=9){var e=null;if(t)for(e=t.commonAncestorContainer,t.collapsed||t.startContainer==t.endContainer&&t.startOffset-t.endOffset<2&&t.startContainer.hasChildNodes()&&(e=t.startContainer.childNodes[t.startOffset]);"element"!=typeOf(e);)e=e.parentNode;return document.id(e)}return document.id(t.item?t.item(0):t.parentElement())},insertContent:function(t){if(Browser.ie){var e=this.getRange();if(e.pasteHTML)e.pasteHTML(t),e.collapse(!1),e.select();else if(e.insertNode)if(e.deleteContents(),e.createContextualFragment)e.insertNode(e.createContextualFragment(t));else{var i=this.win.document,o=i.createDocumentFragment(),s=i.createElement("div");o.appendChild(s),s.outerHTML=t,e.insertNode(o)}}else this.win.document.execCommand("insertHTML",!1,t)}});var n={};MooEditable.Locale={define:function(t,e){return"null"!=typeOf(window.Locale)?Locale.define("en-US","MooEditable",t,e):void("object"==typeOf(t)?Object.merge(n,t):n[t]=e)},get:function(t){return"null"!=typeOf(window.Locale)?Locale.get("MooEditable."+t):t?n[t]:""}},MooEditable.Locale.define({ok:"OK",cancel:"Cancel",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",unorderedList:"Unordered List",orderedList:"Ordered List",indent:"Indent",outdent:"Outdent",undo:"Undo",redo:"Redo",removeHyperlink:"Remove Hyperlink",addHyperlink:"Add Hyperlink",selectTextHyperlink:"Please select the text you wish to hyperlink.",enterURL:"Enter URL",enterImageURL:"Enter image URL",addImage:"Add Image",toggleView:"Toggle View"}),MooEditable.UI={},MooEditable.UI.Toolbar=new Class({Implements:[Events,Options],options:{"class":""},initialize:function(t){this.setOptions(t),this.el=new Element("div",{"class":"mooeditable-ui-toolbar "+this.options["class"]}),this.items={},this.content=null},toElement:function(){return this.el},render:function(t){return this.content?this.el.adopt(this.content):this.content=t.map(function(t){return"|"==t?this.addSeparator():"/"==t?this.addLineSeparator():this.addItem(t)}.bind(this)),this},addItem:function(t){var e=this,i=MooEditable.Actions[t];if(i){var o=i.type||"button",s=i.options||{},n=new(MooEditable.UI[o.camelCase().capitalize()])(Object.append(s,{name:t,"class":t+"-item toolbar-item",title:i.title,onAction:e.itemAction.bind(e),tabindex:-1}));return this.items[t]=n,document.id(n).inject(this.el),n}},getItem:function(t){return this.items[t]},addSeparator:function(){return new Element("span.toolbar-separator").inject(this.el)},addLineSeparator:function(){return new Element("div.toolbar-line-separator").inject(this.el)},itemAction:function(){this.fireEvent("itemAction",arguments)},disable:function(t){return Object.each(this.items,function(e){e.name==t?e.activate():e.deactivate().disable()}),this},enable:function(){return Object.each(this.items,function(t){t.enable()}),this},show:function(){return this.el.setStyle("display",""),this},hide:function(){return this.el.setStyle("display","none"),this}}),!function(){var t="mac"===Browser.platform?"Cmd":"Ctrl";MooEditable.UI.Button=new Class({Implements:[Events,Options],options:{title:"",name:"",text:"Button","class":"",shortcut:"",mode:"icon"},initialize:function(t){this.setOptions(t),this.name=this.options.name,this.render()},toElement:function(){return this.el},render:function(){var e=this.options.shortcut?" ( "+t+"+"+this.options.shortcut.toUpperCase()+" )":"",i=this.options.name,o=this.options.icon||i,s=this.options.title||i,n=s+e;return this.el=new Element("button",{"class":"mooeditable-ui-button "+this.options["class"],title:n,tabindex:-1,html:'<span class="icon-'+o+' button-icon"></span><span class="button-text">'+s+"</span>",events:{click:this.click.bind(this),mousedown:function(t){t.preventDefault()}}}),"icon"!=this.options.mode&&this.el.addClass("mooeditable-ui-button-"+this.options.mode),this.active=!1,this.disabled=!1,Browser.ie&&this.el.addEvents({mouseenter:function(t){this.addClass("hover")},mouseleave:function(t){this.removeClass("hover")}}),this},click:function(t){t.preventDefault(),this.disabled||this.action(t)},action:function(){this.fireEvent("action",[this].concat(Array.from(arguments)))},enable:function(){return this.active&&this.el.removeClass("onActive"),this.disabled?(this.disabled=!1,this.el.removeClass("disabled").set({disabled:!1,opacity:1}),this):void 0},disable:function(){return this.disabled?void 0:(this.disabled=!0,this.el.addClass("disabled").set({disabled:!0,opacity:.4}),this)},activate:function(){return this.disabled?void 0:(this.active=!0,this.el.addClass("onActive"),this)},deactivate:function(){return this.active=!1,this.el.removeClass("onActive"),this}})}(),MooEditable.UI.Dialog=new Class({Implements:[Events,Options],options:{"class":"",contentClass:""},initialize:function(t,e){this.setOptions(e),this.html=t;var i=this;this.el=new Element("div",{"class":"mooeditable-ui-dialog "+i.options["class"],html:'<div class="dialog-content '+i.options.contentClass+'">'+t+"</div>",styles:{display:"none"},events:{click:i.click.bind(i)}})},toElement:function(){return this.el},click:function(){return this.fireEvent("click",arguments),this},open:function(){return this.el.setStyle("display",""),this.fireEvent("open",this),this},close:function(){return this.el.setStyle("display","none"),this.fireEvent("close",this),this}}),MooEditable.UI.AlertDialog=function(t){if(t){var e=t+' <button class="dialog-ok-button">'+MooEditable.Locale.get("ok")+"</button>";return new MooEditable.UI.Dialog(e,{"class":"mooeditable-alert-dialog",onOpen:function(){var t=this.el.getElement(".dialog-ok-button");(function(){t.focus()}).delay(10)},onClick:function(t){t.preventDefault(),"button"==t.target.tagName.toLowerCase()&&document.id(t.target).hasClass("dialog-ok-button")&&this.close()}})}},MooEditable.UI.PromptDialog=function(t,e,i){if(t){var o='<label class="dialog-label">'+t+' <input type="text" class="text dialog-input" value="'+e+'"></label> <button class="dialog-button dialog-ok-button">'+MooEditable.Locale.get("ok")+'</button><button class="dialog-button dialog-cancel-button">'+MooEditable.Locale.get("cancel")+"</button>";return new MooEditable.UI.Dialog(o,{"class":"mooeditable-prompt-dialog",onOpen:function(){var t=this.el.getElement(".dialog-input");(function(){t.focus(),t.select()}).delay(10)},onClick:function(t){if(t.preventDefault(),"button"==t.target.tagName.toLowerCase()){var o=document.id(t.target),s=this.el.getElement(".dialog-input");if(o.hasClass("dialog-cancel-button"))s.set("value",e),this.close();else if(o.hasClass("dialog-ok-button")){var n=s.get("value");s.set("value",e),this.close(),i&&i.attempt(n,this)}}}})}},MooEditable.Actions={bold:{title:MooEditable.Locale.get("bold"),options:{shortcut:"b"},states:{tags:["b","strong"],css:{"font-weight":"bold"}},events:{beforeToggleView:function(){if(Browser.firefox){var t=this.textarea.get("value"),e=t.replace(/<strong([^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>");t!=e&&this.textarea.set("value",e)}},attach:function(){if(Browser.firefox){var t=this.textarea.get("value"),e=t.replace(/<strong([^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>");t!=e&&(this.textarea.set("value",e),this.setContent(e))}}}},italic:{title:MooEditable.Locale.get("italic"),options:{shortcut:"i"},states:{tags:["i","em"],css:{"font-style":"italic"}},events:{beforeToggleView:function(){if(Browser.firefox){var t=this.textarea.get("value"),e=t.replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");t!=e&&this.textarea.set("value",e)}},attach:function(){if(Browser.firefox){var t=this.textarea.get("value"),e=t.replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");t!=e&&(this.textarea.set("value",e),this.setContent(e))}}}},underline:{title:MooEditable.Locale.get("underline"),options:{shortcut:"u"},states:{tags:["u"],css:{"text-decoration":"underline"}},events:{beforeToggleView:function(){if(Browser.firefox||Browser.ie){var t=this.textarea.get("value"),e=t.replace(/<span style="text-decoration: underline;"([^>]*)>/gi,"<u$1>").replace(/<\/span>/gi,"</u>");t!=e&&this.textarea.set("value",e)}},attach:function(){if(Browser.firefox||Browser.ie){var t=this.textarea.get("value"),e=t.replace(/<span style="text-decoration: underline;"([^>]*)>/gi,"<u$1>").replace(/<\/span>/gi,"</u>");t!=e&&(this.textarea.set("value",e),this.setContent(e))}}}},strikethrough:{title:MooEditable.Locale.get("strikethrough"),options:{shortcut:"s"},states:{tags:["s","strike"],css:{"text-decoration":"line-through"}}},insertunorderedlist:{title:MooEditable.Locale.get("unorderedList"),states:{tags:["ul"]},options:{icon:"list-ul"}},insertorderedlist:{title:MooEditable.Locale.get("orderedList"),states:{tags:["ol"]},options:{icon:"list-ol"}},indent:{title:MooEditable.Locale.get("indent"),states:{tags:["blockquote"]},options:{icon:"indent-right"}},outdent:{title:MooEditable.Locale.get("outdent"),options:{icon:"indent-left"}},undo:{title:MooEditable.Locale.get("undo"),options:{shortcut:"z"}},redo:{title:MooEditable.Locale.get("redo"),options:{shortcut:"y",icon:"repeat"}},unlink:{title:MooEditable.Locale.get("removeHyperlink")},createlink:{title:MooEditable.Locale.get("addHyperlink"),options:{shortcut:"l",icon:"link"},states:{tags:["a"]},dialogs:{alert:MooEditable.UI.AlertDialog.pass(MooEditable.Locale.get("selectTextHyperlink")),prompt:function(t){return MooEditable.UI.PromptDialog(MooEditable.Locale.get("enterURL"),"http://",function(e){t.execute("createlink",!1,e.trim())})}},command:function(){var t=this.selection,e=this.dialogs.createlink;if(t.isCollapsed()){var i=t.getNode();if("a"==i.get("tag")&&i.get("href")){t.selectNode(i);var s=e.prompt;s.el.getElement(".dialog-input").set("value",i.get("href")),s.open()}else e.alert.open()}else{var n=t.getText(),s=e.prompt;o.test(n)&&s.el.getElement(".dialog-input").set("value",n),s.open()}}},urlimage:{title:MooEditable.Locale.get("addImage"),options:{shortcut:"m",icon:"picture"},dialogs:{prompt:function(t){return MooEditable.UI.PromptDialog(MooEditable.Locale.get("enterImageURL"),"http://",function(e){t.execute("insertimage",!1,e.trim())})}},command:function(){this.dialogs.urlimage.prompt.open()}},toggleview:{title:MooEditable.Locale.get("toggleView"),command:function(){"textarea"==this.mode?this.toolbar.enable():this.toolbar.disable("toggleview"),this.toggleView()},options:{icon:"code"}}},MooEditable.Actions.Settings={},Element.Properties.mooeditable={get:function(){return this.retrieve("MooEditable")}},Element.implement({mooEditable:function(t){var e=this.get("mooeditable");return e||(e=new MooEditable(this,t)),e}});var a=null,r=null,l=null;window.addEvent("mousedown:relay(.mooeditable-resizer)",function(i,o){i.preventDefault(),a=o.getPrevious(),"none"==a.getStyle("display")&&(a=a.getPrevious()),r=a.getSize().y,l=i.client.y,"IFRAME"==a.tagName&&a.setStyle("visibility","hidden"),window.addEvents({mousemove:t,mouseup:e})})}(),MooEditable.UI.MenuList=new Class({Implements:[Events,Options],options:{title:"",name:"","class":"",list:[]},initialize:function(t){this.setOptions(t),this.name=this.options.name,this.render()},toElement:function(){return this.el},render:function(){var t=this,e="";return this.options.list.each(function(t){e+='<option value="{value}" style="{style}">{text}</option>'.substitute(t)}),this.el=new Element("select",{"class":t.options["class"],title:t.options.title,tabindex:-1,html:e,styles:{height:"21px"},events:{change:t.change.bind(t)}}),this.disabled=!1,Browser.ie&&this.el.addEvents({mouseenter:function(t){this.addClass("hover")},mouseleave:function(t){this.removeClass("hover")}}),this},change:function(t){if(t.preventDefault(),!this.disabled){var e=t.target.value;this.action(e)}},action:function(){this.fireEvent("action",[this].concat(Array.from(arguments)))},enable:function(){return this.disabled?(this.disabled=!1,this.el.set("disabled",!1).removeClass("disabled").set({disabled:!1,opacity:1}),this):void 0},disable:function(){return this.disabled?void 0:(this.disabled=!0,this.el.set("disabled",!0).addClass("disabled").set({disabled:!0,opacity:.4}),this)},activate:function(t){if(!this.disabled){var e=0;return t&&this.options.list.each(function(i,o){i.value==t&&(e=o)}),this.el.selectedIndex=e,this}},deactivate:function(){return this.el.selectedIndex=0,this.el.removeClass("onActive"),this}}),MooEditable.Locale.define({blockFormatting:"Format de block",paragraph:"Paragraphe",heading1:"En-tÃªte 1",heading2:"En-tÃªte 2",heading3:"En-tÃªte 3",heading4:"En-tÃªte 4",alignLeft:"Align Left",alignRight:"Align Right",alignCenter:"Align Center",alignJustify:"Align Justify",removeFormatting:"Remove Formatting",insertHorizontalRule:"Insert Horizontal Rule"}),Object.append(MooEditable.Actions,{formatBlock:{title:MooEditable.Locale.get("blockFormatting"),type:"menu-list",options:{list:[{text:MooEditable.Locale.get("paragraph"),value:"p"},{text:MooEditable.Locale.get("heading2"),value:"h2",style:"font-size:18px; font-weight:bold;"},{text:MooEditable.Locale.get("heading3"),value:"h3",style:"font-size:14px; font-weight:bold;"},{text:MooEditable.Locale.get("heading4"),value:"h4",style:"font-size:12px; font-weight:bold;"}]},states:{tags:["p","h2","h3","h4"]},command:function(t,e){var i="<"+e+">";this.focus(),this.execute("formatBlock",!1,i)}},justifyleft:{title:MooEditable.Locale.get("alignLeft"),states:{css:{"text-align":"left"}},command:function(t,e){var i=this.selection.getNode(),o=i.tagName;"IMG"==o||"OBJECT"==o?i.align="left":"P"==o&&(i.align="")},options:{icon:"align-left"}},justifyright:{title:MooEditable.Locale.get("alignRight"),states:{css:{"text-align":"right"}},command:function(t,e){var i=this.selection.getNode(),o=i.tagName;"IMG"==o||"OBJECT"==o?i.align="right":"P"==o&&(i.align="right")},options:{icon:"align-right"}},justifycenter:{
title:MooEditable.Locale.get("alignCenter"),states:{tags:["center"],css:{"text-align":"center"}},options:{icon:"align-center"}},justifyfull:{title:MooEditable.Locale.get("alignJustify"),states:{css:{"text-align":"justify"}},options:{icon:"align-justify"}},removeformat:{title:MooEditable.Locale.get("removeFormatting"),options:{icon:"eraser"}},insertHorizontalRule:{title:MooEditable.Locale.get("insertHorizontalRule"),states:{tags:["hr"]},command:function(){this.selection.insertContent("<hr>")}}}),MooEditable.UI.PasteDialog=new Class({Extends:MooEditable.UI.Dialog,initialize:function(t){this.editor=t,this.unique=Math.random(),this.dummy_el=new Element("div",{styles:{display:"none"}})},toElement:function(){return this.dummy_el},close:function(){return this.adjust&&(this.adjust.destroy(),this.adjust=null),this.fireEvent("close",this),this},open:function(){if(this.adjust)return this.close();var t=this.editor,e=t.toolbar.items.paste.el,i=e.getCoordinates();adjust=new Element("div",{"class":"mooeditable-ui-dialog mooeditable-paste-dialog",styles:{position:"absolute",width:"64ex",left:i.left+i.width/2,"margin-left":"-32ex",top:i.bottom+20}}),this.adjust=adjust;var o,s,n=new Element("div",{"class":"mooeditable-ui-dialog-action-frame"});n.adopt(s=new Element("button.btn-primary",{type:"button",html:"Coller"}));var a=new Element("div",{"class":"mooeditable-ui-dialog-contents-frame"});a.adopt(o=new Element("textarea",{rows:10})),adjust.adopt(a,n),s.addEvent("click",function(e){var i=o.get("value");i&&(i=i.replace(/\r?\n\r?\n/gi,"</p><p>"),i=i.replace(/\r?\n/gi,"<br />"),i="<p>"+i+"</p>",t.selection.insertContent(i)),this.close()}.bind(this)),document.body.appendChild(adjust),o.focus()}}),MooEditable.Actions.paste={title:"Paste text, stripping formating",dialogs:{prompt:function(t){return new MooEditable.UI.PasteDialog(t)}},command:function(){this.dialogs.paste.prompt.open()}},!function(){function t(t,e){return t=t.replace(/<(\w+)([^>]*)>\s+/g,"<$1$2>\n"),t=t.replace(/>\s+</g,">\n<"),e?this.options.paragraphise?(t="<p>"+t+"</p>",t=t.replace(/\n\n/g,"</p><p>"),t=t.replace(/<p>\s<\/p>/gi,"")):t=t.replace(/\n/g,"<br />"):(t=t.replace(/<html[^>]*?>(.*)/gim,"$1"),t=t.replace(/<\/html>/gi,""),t=t.replace(/<body[^>]*?>(.*)/gi,"$1"),t=t.replace(/<\/body>/gi,""),t=t.replace(/<style[^>]*?>[\s\S]*?<\/style[^>]*>/gi,""),t=t.replace(/<(?:meta|link)[^>]*>\s*/gi,""),t=t.replace(/<\\?\?xml[^>]*>/gi,""),t=t.replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,""),t=t.replace(/<o:p>\s*<\/o:p>/g,""),t=t.replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;"),t=t.replace(/<\/?\w+:[^>]*>/gi,""),t=t.replace(/<\!--[\s\S]*?-->/g,""),t=t.replace(/<\!\[[\s\S]*?\]>/g,""),t=t.replace(/\s*mso-[^:]+:[^;"']+;?/gi,""),t=t.replace(/<(\w[^>]*) style='([^\']*)'([^>]*)/gim,"<$1$3"),t=t.replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gim,"<$1$3"),t=t.replace(/\s*margin: 0cm 0cm 0pt\s*;/gi,""),t=t.replace(/\s*margin: 0cm 0cm 0pt\s*"/gi,'"'),t=t.replace(/\s*text-indent: 0cm\s*;/gi,""),t=t.replace(/\s*text-indent: 0cm\s*"/gi,'"'),t=t.replace(/\s*text-align: [^\s;]+;?"/gi,'"'),t=t.replace(/\s*page-break-before: [^\s;]+;?"/gi,'"'),t=t.replace(/\s*font-variant: [^\s;]+;?"/gi,'"'),t=t.replace(/\s*tab-stops:[^;"']*;?/gi,""),t=t.replace(/\s*tab-stops:[^"']*/gi,""),t=t.replace(/\s*face="[^"']*"/gi,""),t=t.replace(/\s*face=[^ >]*/gi,""),t=t.replace(/\s*font-family:[^;"']*;?/gi,""),t=t.replace(/\s*font-size:[^;"']*;?/gi,""),t=t.replace(/\<[\w[^>]*\sclass="([^"]+)"/,function(t,e){return t.replace(e,e.replace(/Mso[^\s]+/gi,"").trim())}),t=t.replace(/<(\w+)[^>]*\sstyle="[^"']*display\s?:\s?none[\s \S]*?<\/\1>/gi,""),t=t.replace(/\s*style='\s*'/gi,""),t=t.replace(/\s*style="\s*"/gi,""),t=t.replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/gi,"&nbsp;"),t=t.replace(/<span\s*[^>]*><\/span>/gi,""),t=t.replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3"),t=t.replace(/<(font|i|span|strike|u)(\s*>|\s+[^>]+>)/gi,""),t=t.replace(/<\/(font|i|span|strike|u)>/gi,""),t=t.replace(/<h\d>\s*<\/h\d>/gi,""),t=t.replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3"),t=t.replace(/<(\w[^>]*) onmouseover="([^\"']*)"([^>]*)/gi,"<$1$3"),t=t.replace(/<(\w[^>]*) onmouseout="([^\"']*)"([^>]*)/gi,"<$1$3"),t=t.replace(/<(h\d)><em>([\s\S]*?)<\/em><\/\1>/gi,"<$1>$2</$1>"),t=t.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>"),t=t.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>"),t=t.replace(/<\s+[^>]*>/gi,""),t=t.replace(/<(td|th)([^>]*)>\s*<\/(td|th)>/gi,"<$1$2>&nbsp;</$1>"),t=t.replace(/<br>/gi,"<br />"),t=t.replace(/^(\s*<br \/>\s*)+|(\s*<br \/>\s*)+$/gi,""),t=t.replace(/(\s*<br \/>\s*)+<\/p>/gim,"</p>"),t=t.replace(/<((?!th|td)\w+)[^>]*>\s*&nbsp;\s*<\/\1>/gi,""),t=t.replace(/<p>\s<\/p>/gi,""),t=t.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,function(t,e){return e.match(/^iframe$/i)?t:""}),t=t.trim()),t=this.manageSrcAttribute(t)}try{return void(module.exports.cleanHtml=t)}catch(e){}MooEditable=Class.refactor(MooEditable,{attach:function(){var t=this.previous();return this.doc.body.addListener("paste",this.cleanPaste.bind(this)),t},cleanPaste:function(t){var e=t.clipboardData&&t.clipboardData.getData?t.clipboardData.getData("text/html"):window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):!1;return e&&""!==e.trim()||!t.clipboardData||!t.clipboardData.getData||(e=t.clipboardData.getData("Text")),e?(window.clipboardData?this.selection.insertContent(this.cleanHtml(e,1)):this.selection.insertContent(this.cleanHtml(e)),t.preventDefault(),t.stopPropagation()):(this.selection.insertContent('<span id="INSERTION_MARKER">&nbsp;</span>'),this.txtMarked=this.doc.body.get("html"),this.doc.body.set("html",""),this.replaceMarkerWithPastedText.delay(5,this)),this},replaceMarkerWithPastedText:function(){var t=this.cleanHtml(this.doc.body.get("html"));return this.doc.body.set("html",this.txtMarked),this.selection.selectNode(this.doc.body.getElementById("INSERTION_MARKER")),this.selection.insertContent(t),this},cleanHtml:function(e,i){return t.call(this,e,i)}})}(),MooEditable.Actions.outline={title:"Outline blocks",command:function(){this.doc.body.toggleClass("mooeditable-outline")},options:{icon:"info"}},MooEditable.UI.ImageDialog=function(){var t="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////IiIiHNlGNAAAAAF0Uk5TAEDm2GYAAAAeSURBVHjaYmBkYMCPKJVnZBi1YtSKUSuGphUAAQYAxEkBVsmDp6QAAAAASUVORK5CYII=";return new Class({Extends:MooEditable.UI.Dialog,initialize:function(t){this.editor=t,this.unique=Math.random(),this.dummy_el=new Element("div",{styles:{display:"none"}})},toElement:function(){return this.dummy_el},click:function(){return this.fireEvent("click",arguments),this},close:function(){return this.popover&&this.popover.hide(),this.fireEvent("close",this),this},open:function(){this.node=this.editor.selection.getNode(),this.node&&"img"==this.node.get("tag")||(this.node=this.editor.doc.createElement("img"),this.node.src=t,this.editor.selection.getRange().insertNode(this.node)),this.node.addEvent("load",function(t){this.popover&&this.popover.reposition()}.bind(this)),this.previousImage=this.getValidSrc(),this.popover?(this.popover.attachAnchor(this.node),this.popover.adjust.setValue(this.getValidNode()),this.popover.show()):(this.fetchAdjustOperation||(this.fetchAdjustOperation=new Request.Widget("adjust-thumbnail/popup",this.setupPopover.bind(this))),this.fetchAdjustOperation.get({selected:this.getValidSrc()}))},getValidNode:function(){var t=this.node;return t&&t.src&&!t.src.test(/^data:/)?t:null},getValidSrc:function(){var t=this.getValidNode();return t?t.get("src"):null},setupPopover:function(t){var e=require("icybee/adjust-popover"),i=this.popover=new e(t,{anchor:this.node,iframe:this.editor.iframe}),o=i.getAdjust();i.addEvent("action",function(t){var e=t.action,i=this.getValidSrc();"cancel"==e?(i=this.previousImage,this.node.src=i||""):"remove"==e&&(i=null),(!i||i.match(/^data:/))&&(this.node.destroy(),delete this.node),this.close()}.bind(this)),o.setValue(this.getValidNode()),o.addEvent("change",function(t){var e=t.options,i=this.node;i.src=this.editor.baseHREF+t.url,i.set("data-nid",t.nid),e.lightbox?i.set("data-lightbox",!0):i.removeAttribute("data-lightbox"),e.width&&"surface"!=e.method&&"constrained"!=e.method?i.set("width",e.width):i.removeAttribute("width"),e.height&&"surface"!=e.method&&"constrained"!=e.method?i.set("height",e.height):i.removeAttribute("height")}.bind(this)),i.show()}})}(),MooEditable.Actions.image={title:"Add/Edit Image",options:{shortcut:"m",icon:"picture"},dialogs:{prompt:function(t){return new MooEditable.UI.ImageDialog(t)}},command:function(){this.dialogs.image.prompt.open()}},!function(t){var e=[];t.observe("update",function(){Array.prototype.forEach.call(document.body.querySelectorAll("textarea.moo"),function(i){var o=t.uidOf(i);if(!(o in e)){var s=t.Dataset.from(i);s.externalCss&&(s.externalCSS=JSON.decode(s.externalCss)),s.baseUrl&&(s.baseURL=s.baseUrl),e[o]=i.mooEditable(s)}})})}(Brickrouge);